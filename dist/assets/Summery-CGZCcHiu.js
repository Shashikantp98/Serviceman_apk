import{r as n,R as C,P as T,j as e,y as $,u as X,c as ge,S as xe,A as y,a as fe,d as je,e as _e}from"./index-DEIqmbY-.js";import{R as be}from"./RazorpayPayment-C0rDznpF.js";import{R as ye}from"./index-C6PswM7T.js";function E(){return E=Object.assign||function(o){for(var i=1;i<arguments.length;i++){var l=arguments[i];for(var t in l)Object.prototype.hasOwnProperty.call(l,t)&&(o[t]=l[t])}return o},E.apply(this,arguments)}function Ne(o,i){if(o==null)return{};var l=ve(o,i),t,d;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(o);for(d=0;d<a.length;d++)t=a[d],!(i.indexOf(t)>=0)&&Object.prototype.propertyIsEnumerable.call(o,t)&&(l[t]=o[t])}return l}function ve(o,i){if(o==null)return{};var l={},t=Object.keys(o),d,a;for(a=0;a<t.length;a++)d=t[a],!(i.indexOf(d)>=0)&&(l[d]=o[d]);return l}var R=n.forwardRef(function(o,i){var l=o.color,t=l===void 0?"currentColor":l,d=o.size,a=d===void 0?24:d,j=Ne(o,["color","size"]);return C.createElement("svg",E({ref:i,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:t,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},j),C.createElement("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),C.createElement("line",{x1:"5",y1:"12",x2:"19",y2:"12"}))});R.propTypes={color:T.string,size:T.oneOfType([T.string,T.number])};R.displayName="Plus";const ke=({onSelect:o,onExit:i})=>{const[l,t]=n.useState(null),[d,a]=n.useState(null),[j,b]=n.useState(""),[f,N]=n.useState(!1),v=Array.from({length:3},(r,p)=>{const u=new Date;u.setDate(u.getDate()+p);const _=u.toLocaleDateString("en-US",{weekday:"short"}),k=u.getDate();return{id:p,label:`${_} ${k}`,value:u.toISOString().split("T")[0]}}),c=Array.from({length:12*2+1},(r,p)=>{const u=9+p*.5,_=Math.floor(u),k=u%1===0?"00":"30",F=u>=12?"PM":"AM";return{label:`${_>12?_-12:_}:${k} ${F}`,hour:_,minutes:k}}),L=r=>{if(!l)return!1;const p=new Date,u=new Date(l);return p.getFullYear()===u.getFullYear()&&p.getMonth()===u.getMonth()&&p.getDate()===u.getDate()?p.getHours()>=r:!1},O=()=>{l&&d?(N(!0),o(l,d,j||""),setTimeout(()=>{i&&i()},6e3)):$.error("Please select date and time")};return e.jsx("div",{className:"wrappers",children:e.jsxs("div",{className:"popups",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h6",{children:"Select Date & Time"}),e.jsx("button",{onClick:i,className:"pclosebtn",children:"Close"})]}),e.jsx("p",{className:"font-14 color-grey",children:"Your service will take approx. 45 mins"}),e.jsx("div",{className:"d-flex align-items-center gap-10 flex-wrap",children:v.map(r=>e.jsxs(C.Fragment,{children:[e.jsx("input",{id:`day-${r.id}`,type:"radio",name:"day",value:r.value,checked:l===r.value,onChange:()=>{t(r.value),a(null)},className:"dayys"}),e.jsxs("label",{htmlFor:`day-${r.id}`,className:"day-label",children:[e.jsx("b",{children:r.label.split(" ")[0]}),e.jsx("p",{children:r.label.split(" ")[1]})]})]},r.id))}),l&&e.jsx("div",{className:"d-flex flex-wrap pt-3 align-items-center gap-10",children:c.map((r,p)=>{const u=L(r.hour-1);return e.jsx(C.Fragment,{children:!u&&e.jsxs(e.Fragment,{children:[e.jsx("input",{id:`time-${p}`,type:"radio",name:"time",value:r.label,checked:d===r.label,onChange:()=>a(r.label),disabled:u,className:"dayys"}),e.jsx("label",{htmlFor:`time-${p}`,className:`time-label ${u?"disabled":""}`,children:e.jsx("b",{children:r.label})})]})},p)})}),e.jsx("div",{className:"pt-3",children:e.jsx("textarea",{className:"textar",value:j,onChange:r=>b(r.target.value),placeholder:"Add any note..."})}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{className:"fill",onClick:O,disabled:f,children:f?"Proceeding...":"Proceed"})})]})})},Pe=({onSelect:o,service_id:i,onExit:l})=>{const t=X(),[d,a]=n.useState([]),[j,b]=n.useState(null),f=ge("address-loader"),N=()=>{f.setLoading(!0),y.post("/user/getCustomerAddress",{service_id:i}).then(c=>{a(c.data||[])}).catch(c=>{console.log(c),$.error("Failed to fetch addresses")}).finally(()=>{f.setLoading(!1)})};n.useEffect(()=>{N()},[]);const v=()=>{j?o(j):$.error("Please select an address")};return e.jsx("div",{className:"wrappers",children:e.jsxs("div",{className:"popups",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h6",{children:"Select Address"}),e.jsx("button",{onClick:l,className:"pclosebtn",children:"Close"})]}),e.jsx("div",{className:"border-bottom pb-3 pt-2 mb-3",children:e.jsxs("button",{className:"addr_btn",onClick:()=>t("/authlocation",{state:{id:"add"}}),children:[e.jsx(R,{}),"Â Add new Address"]})}),e.jsx(xe,{show:f.loading,size:"medium",text:"Loading your addresses...",overlay:!0}),!f.loading&&d.length>0?d.map(c=>e.jsxs("div",{className:"d-flex gap-10",children:[e.jsxs("div",{className:"pt-1",children:[e.jsx("input",{id:c._id,type:"radio",className:"add-rad",checked:c._id===j,onChange:()=>b(c._id)}),e.jsx("label",{htmlFor:c._id,children:e.jsx("span",{})})]}),e.jsx("div",{children:e.jsx("label",{htmlFor:c._id,children:e.jsxs("p",{className:"font-12 color-grey",children:[c.street_1,", ",c.city,", ",c.state,", ",c.zip,", ",c.country]})})})]},c._id)):!f.loading&&e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("h1",{className:"bigemj",children:"ðŸ "}),e.jsx("p",{children:"No addresses found"})]}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{className:"fill",onClick:v,children:"Proceed"})})]})})},Se=({show:o,text:i="Please wait..."})=>o?ye.createPortal(e.jsxs("div",{className:"full-page-loader",children:[e.jsx("div",{className:"loader-spinner"}),e.jsx("p",{children:i})]}),document.getElementById("loader-root")):null,Te=()=>{var M,W,Y,U;const{latitude:o,longitude:i}=fe(),l=X(),[t,d]=n.useState({}),[a,j]=n.useState({itemTotal:t==null?void 0:t.price,discount:0,taxAmount:t==null?void 0:t.tax_amount,totalAmount:(t==null?void 0:t.price)+(t==null?void 0:t.tax_amount)}),{id:b}=je(),[f,N]=n.useState([]),[v,c]=n.useState(1),[L,O]=n.useState(""),[r,p]=n.useState(""),[u,_]=n.useState(!1),[k,F]=n.useState(""),[z,P]=n.useState(""),[Z,S]=n.useState(!1),[h,D]=n.useState({}),[ee,B]=n.useState(""),[te,se]=n.useState(""),[ae,oe]=n.useState(""),[ne,I]=n.useState(!1);n.useEffect(()=>{b&&(ce(),le(),y.post("/user/serviceDetails",{service_id:b,latitude:Number(o),longitude:Number(i)}).then(s=>{console.log(s),d(s.data),j({itemTotal:s.data.offer_price?s.data.offer_price:s.data.price,discount:s.data.offer_price?s.data.price-s.data.offer_price:0,taxAmount:s.data.tax_amount,totalAmount:s.data.offer_price?s.data.offer_price+s.data.tax_amount:s.data.price+s.data.tax_amount})}).catch(s=>{console.log(s)}))},[b]);const le=()=>{y.post("/user/getCustomerDetails").then(s=>{console.log(s),D(s.data)}).catch(s=>{console.log(s)})},ce=()=>{y.post("/user/listCouponsForUser",{}).then(s=>{console.log(s);var g=[];for(let m=0;m<s.data.list.length;m++){const x=s.data.list[m];x.isCouponApplied=!1,g.push(x)}N(g)}).catch(s=>{console.log(s)})},re=(s,g)=>{y.post("/user/userApplyCouponForBooking",{coupon_code:s.coupon_code,service_charge:t==null?void 0:t.price,tax_and_other_charges:t==null?void 0:t.tax_amount}).then(m=>{var w,A,V,q,G,J,K,Q;console.log(m),j({itemTotal:(A=(w=m.data)==null?void 0:w.bill_details)==null?void 0:A.subtotal,discount:(q=(V=m.data)==null?void 0:V.bill_details)==null?void 0:q.discount,taxAmount:(J=(G=m.data)==null?void 0:G.bill_details)==null?void 0:J.tax_and_other_charges,totalAmount:(Q=(K=m.data)==null?void 0:K.bill_details)==null?void 0:Q.grand_total}),p(s.coupon_code),p(s.coupon_code);const x=f.map((he,pe)=>({...he,isCouponApplied:pe===g}));N(x)}).catch(m=>{console.log(m)})},de=(s,g,m)=>{console.log("Selected:",s,g,m),_(!0),se(s),oe(g),y.post("/user/userCreateBooking",{address_id:L,service_id:b,booking_date:s,booking_time:g,job_description:m,booking_fee:t==null?void 0:t.booking_fee,service_charge:a==null?void 0:a.itemTotal,tax_and_other_charges:a==null?void 0:a.taxAmount,booking_amount:a==null?void 0:a.totalAmount,payment_method:"online",payment_type:ee,coupon_code:r}).then(x=>{var w,A;console.log(x),_(!1),F((w=x.data)==null?void 0:w.booking_id),P((A=x.data)==null?void 0:A.razorpay_order_id),S(!0)}).catch(x=>{console.log(x),_(!1)})},ie=s=>{console.log("Payment Success:",s),I(!0),y.post("/user/verifyBookingPayment",{razorpay_order_id:s.razorpay_order_id,razorpay_payment_id:s.razorpay_payment_id,razorpay_signature:s.razorpay_signature,booking_id:k}).then(g=>{console.log("Payment verification success:",g.data),S(!1),P(""),setTimeout(()=>{var m,x;I(!1),l("/succcess",{state:{name:((m=h==null?void 0:h.customer)==null?void 0:m.fname)+" "+((x=h==null?void 0:h.customer)==null?void 0:x.lname),service_name:t==null?void 0:t.service_name,booking_date:te,booking_time:ae}})},1200)}).catch(g=>{var m,x;console.log("Payment verification error:",g),I(!1),S(!1),P(""),alert("Payment verification failed: "+(((x=(m=g.response)==null?void 0:m.data)==null?void 0:x.message)||g.message))})},ue=s=>{console.log("Payment Cancelled or Failed:",s),alert("Payment Failed"),_(!1),S(!1)},me=s=>{console.log("Selected:",s),O(s),c(3)},H=()=>{S(!1),P(""),c(1)};return e.jsxs(e.Fragment,{children:[e.jsx(Se,{show:ne,text:"Please wait..."}),e.jsx(_e,{}),e.jsxs("div",{className:"container mb-5 pb-5 main-content-service",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("h6",{className:"pt-4 pb-2",children:"Selected Service"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsx("img",{src:t==null?void 0:t.service_image_url,style:{width:"100%",maxHeight:"300px",objectFit:"cover",borderRadius:"8px"}}),e.jsxs("div",{className:"sum_det",children:[e.jsx("h6",{className:"mb-1",children:t==null?void 0:t.service_name}),e.jsx("p",{className:"font-12 color-grey mb-0",dangerouslySetInnerHTML:{__html:t==null?void 0:t.description}}),e.jsxs("b",{className:"font-12",children:["â‚¹",t!=null&&t.offer_price?t==null?void 0:t.offer_price:t==null?void 0:t.price," ","- Duration : ",t==null?void 0:t.duration]}),e.jsxs("p",{className:"font-12 color-grey",children:["â‚¹",t==null?void 0:t.booking_fee," will be charged for generate request."]})]})]})]}),e.jsxs("div",{className:"col-12 mt-3",children:[!(t!=null&&t.offer_price)&&e.jsxs("div",{className:"cou_cards",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"head_cp mb-0 font-14",children:"Coupons & offers"}),e.jsxs("b",{className:"cblu font-14",children:[f.length," offers"]})]}),f.length>0&&f.map((s,g)=>e.jsxs("div",{className:"d-flex mt-3 align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"font-14 cblu mb-1",children:s.discount_name}),e.jsx("p",{className:"mb-0 font-12 color-grey",dangerouslySetInnerHTML:{__html:s.description}})]}),e.jsx("button",{className:"apbtn",onClick:()=>re(s,g),children:s.isCouponApplied?"Applied":"Apply"})]},s._id))]}),e.jsxs("div",{className:"cou_cards mt-3",children:[e.jsx("h6",{className:"head_cp mb-0 font-14",children:"Payments summary"}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("p",{className:"font-12 my-2",children:"Item total"}),e.jsxs("p",{className:"font-12 my-2 color-grey text-right",children:["â‚¹",a==null?void 0:a.itemTotal," "]})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("p",{className:"font-12 my-2",children:"Discount "}),e.jsxs("p",{className:"font-12 my-2 color-grey text-right",children:["â‚¹",a==null?void 0:a.discount," "]})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("p",{className:"font-12 my-2",children:"Tax and fee"}),e.jsxs("p",{className:"font-12 my-2 color-grey text-right",children:["â‚¹",a==null?void 0:a.taxAmount," "]})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("p",{className:"font-14 my-2",children:"Amount to pay"}),e.jsxs("p",{className:"font-14 my-2 color-grey text-right",children:["â‚¹",a==null?void 0:a.totalAmount," "]})]})]})]})]}),e.jsxs("div",{className:"row pt-3",children:[e.jsx("div",{className:"col-12",children:e.jsx("button",{className:"outline rfuls",onClick:()=>{B("booking_fee"),c(2)},children:u?"Loading...":"Book service @ â‚¹"+(t!=null&&t.booking_fee?t==null?void 0:t.booking_fee:"")})}),e.jsx("div",{className:"col-12 pt-2",children:e.jsx("button",{className:"fill rfuls",onClick:()=>{B("full_payment"),c(2)},children:u?"Loading...":"Pay Complete Amount"})})]}),v===2&&e.jsx(Pe,{onSelect:me,service_id:b,onExit:H}),v===3&&e.jsx(ke,{onSelect:de,onExit:H}),Z&&z&&e.jsx(be,{orderId:z,amount:(a==null?void 0:a.totalAmount)*100,name:((M=h==null?void 0:h.customer)==null?void 0:M.fname)+" "+((W=h==null?void 0:h.customer)==null?void 0:W.lname),email:(Y=h==null?void 0:h.customer)==null?void 0:Y.email,contact:(U=h==null?void 0:h.customer)==null?void 0:U.phone_primary,onSuccess:ie,onFailure:ue})]})]})};export{Te as default};
