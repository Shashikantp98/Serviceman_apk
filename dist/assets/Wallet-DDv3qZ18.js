import{r as s,c as p,j as e,S as b,A as c,y as r}from"./index-DEIqmbY-.js";import{d as S}from"./dayjs.min-CYIzaLsb.js";import{S as L}from"./ServiceManHeader-DZYdVDsG.js";const H=()=>{const[i,N]=s.useState([]),[d,v]=s.useState(0),[y,n]=s.useState(!1),[m,h]=s.useState(""),[u,x]=s.useState(!1),o=p("wallet-balance"),t=p("withdraw-history"),w=()=>{o.setLoading(!0),c.get("/servicemen/getTotalWalletBalance").then(a=>{v(a.data.wallet_balance)}).catch(a=>{console.error("Error fetching wallet balance:",a)}).finally(()=>o.setLoading(!1))},f=()=>{t.setLoading(!0),c.post("/servicemen/listWithdrawalHistory",{}).then(a=>{N(a.data.list)}).catch(a=>{console.error("Error fetching withdrawal history:",a)}).finally(()=>t.setLoading(!1))},W=()=>{const a=Number(m);if(!a||a<=0)return r.error("Enter a valid amount");if(a>d)return r.error("Insufficient balance");x(!0),c.post("/servicemen/requestWithdrawal",{amount:a}).then(l=>{r.success(l.data.message),n(!1),h(""),w(),f()}).catch(l=>{var j,g;console.error("Error withdrawing:",l),r.error(((g=(j=l.response)==null?void 0:j.data)==null?void 0:g.message)||"Something went wrong")}).finally(()=>x(!1))};return s.useEffect(()=>{w(),f()},[]),e.jsxs(e.Fragment,{children:[e.jsx(L,{title:"My Wallet"}),e.jsxs("div",{className:"container main-content-service pb-5 mb-5",children:[e.jsx("div",{className:"row px-2",children:e.jsxs("div",{className:"col-12 pt-2",children:[e.jsxs("div",{className:"wallet-balance-card",children:[e.jsx("p",{className:"font-14 color-grey mb-2",children:"Wallet Balance"}),o.loading?e.jsx(b,{show:!0,size:"medium",overlay:!1,text:""}):e.jsxs("b",{className:"wallet-balance-amount",children:["₹",d]})]}),e.jsx("button",{className:"fill mt-3",onClick:()=>n(!0),children:"Withdraw Amount"})]})}),y&&e.jsx("div",{className:"modal-overlay",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("h5",{className:"mb-3",children:"Withdraw Amount"}),e.jsx("input",{type:"number",className:"form-control mb-3",placeholder:"Enter amount",value:m,onChange:a=>h(a.target.value)}),e.jsxs("div",{className:"d-flex justify-content-end gap-2",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>n(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",disabled:u,onClick:W,children:u?"Processing...":"Withdraw"})]})]})}),e.jsxs("div",{className:"row px-2 mt-3",children:[e.jsx("div",{className:"col-12",children:e.jsx("h6",{className:"weight-bold mb-3",children:"Withdrawal History"})}),e.jsx(b,{show:t.loading,size:"medium",overlay:!1,text:"Loading..."}),!t.loading&&i.length===0?e.jsx("div",{className:"col-12 text-center py-4",children:e.jsx("p",{className:"font-14 color-grey",children:"No withdrawal history found"})}):i.map(a=>e.jsx("div",{className:"col-12 mb-3",children:e.jsx("div",{className:"wallet-card shadow-sm p-3 rounded",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-12 color-grey mb-1",children:"Remarks"}),e.jsx("p",{className:"font-14 mb-1 fw-semibold",children:a.remarks}),e.jsx("p",{className:"font-12 color-grey",children:S(a.created_on).format("DD MMM YYYY • hh:mm A")})]}),e.jsxs("div",{className:"wallet-right",children:[e.jsx("span",{className:`status-badge ${a.status==="completed"?"status-success":a.status==="pending"?"status-warning":"status-error"}`,children:a.status}),e.jsxs("p",{className:"amount",children:["₹",a.amount]})]})]})})},a._id))]})]})]})};export{H as default};
