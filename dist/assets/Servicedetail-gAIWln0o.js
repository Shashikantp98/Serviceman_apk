import{u as C,a as A,r as i,c as u,d as E,A as x,j as e,e as z,S as f,y as B}from"./index-DEIqmbY-.js";import{L as I}from"./LoginModal-CIJNsLlE.js";import{d as V}from"./dayjs.min-CYIzaLsb.js";import{A as Y}from"./arrow-up-right-CZV7zgvh.js";import"./Spinner-YBZ7XAN5.js";import"./index-C6PswM7T.js";const U=()=>{const m=C(),{logout:p,token:j,latitude:v,longitude:N}=A(),[s,_]=i.useState({}),[o,b]=i.useState([]),[h,w]=i.useState(0),r=i.useRef(null),l=u("service-details"),c=u("reviews"),{id:n}=E(),[y,d]=i.useState(!1);i.useEffect(()=>{n&&(l.setLoading(!0),x.post("/user/serviceDetails",{service_id:n,latitude:Number(v),longitude:Number(N)}).then(t=>{console.log(t),_(t.data)}).catch(t=>{console.log(t)}).finally(()=>{l.setLoading(!1)}))},[n]),i.useEffect(()=>{if(!n)return;(async()=>{c.setLoading(!0);try{const a=await x.post("/user/getServiceReviews",{service_id:n});if(a!=null&&a.data&&Array.isArray(a.data)&&(b(a.data),a.data.length>0)){const R=a.data.reduce((k,M)=>k+M.rating,0)/a.data.length;w(Math.round(R*10)/10)}}catch(a){console.log("Error fetching reviews:",a)}finally{c.setLoading(!1)}})()},[n]);const g=()=>{j=="guest"?d(!0):s.is_available?m(`/summery/${s==null?void 0:s.service_id}`):B.error(s.availability_message)},S=t=>({1:"Very Bad",2:"Bad",3:"Good",4:"Very Good",5:"Excellent"})[t]||"No Rating",L=t=>t||"https://via.placeholder.com/40";return e.jsxs(e.Fragment,{children:[e.jsx(z,{}),l.loading?e.jsx("div",{style:{height:"80vh",display:"flex",justifyContent:"center",alignItems:"center"},children:e.jsx(f,{show:!0,size:"large",text:"Loading service details..."})}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container pb-5 mb-5 main-content-service",children:[e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 pt-3",children:e.jsx("img",{src:s==null?void 0:s.service_image_url,className:"w-100 rounded-full"})}),e.jsxs("div",{className:"col-12 sder_detail",children:[e.jsxs("div",{className:"d-flex gap-3  justify-content-between pt-4 align-items-center",children:[e.jsx("h4",{className:"mb-0",children:s==null?void 0:s.service_name}),e.jsx("button",{className:" book_servi2",onClick:g,children:"Book Now"})]}),e.jsxs("h6",{className:"pt-2",onClick:()=>{(s==null?void 0:s.total_reviews)>0&&r.current&&r.current.scrollIntoView({behavior:"smooth",block:"start"})},children:["★ ",(s==null?void 0:s.avg_rating)||"0"," (",(s==null?void 0:s.total_reviews)||"0"," reviews)"]}),e.jsx("p",{className:"mb-2 pt-2",dangerouslySetInnerHTML:{__html:s==null?void 0:s.description}}),e.jsx("p",{children:e.jsxs("b",{children:["₹",s!=null&&s.offer_price?s==null?void 0:s.offer_price:s==null?void 0:s.price," ","- Duration : ",s==null?void 0:s.duration]})}),c.loading?e.jsx("div",{style:{marginTop:"24px"},children:e.jsx(f,{show:!0,size:"medium",text:"Loading reviews..."})}):o.length>0?e.jsxs("div",{className:"pt-3",ref:r,children:[e.jsxs("div",{className:"d-flex pb-3 align-items-center justify-content-between",children:[e.jsx("h5",{style:{margin:0,fontSize:"16px",fontWeight:"600"},children:"Customer Reviews"}),e.jsxs("div",{className:"d-flex align-items-center gap-1",children:[e.jsx("span",{className:"font-12",children:h}),e.jsx("div",{children:[1,2,3,4,5].map(t=>e.jsx("span",{style:{fontSize:"14px",color:t<=Math.round(h)?"#ffc107":"#ddd"},children:"★"},t))}),e.jsxs("span",{className:"font-12 text-blue",children:["(",o.length," reviews )"]})]})]}),o.slice(0,3).map(t=>e.jsxs("div",{className:"revs_carrdss mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("img",{className:"rev_cs_imgs",src:L(t.customer_id.profile_image),alt:t.customer_id.fname,onError:a=>{a.target.src="https://via.placeholder.com/36"}}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-0 cusnms",children:[t.customer_id.fname," ",t.customer_id.lname]}),e.jsx("p",{className:"mb-0 cusdatetime",children:V(t.created_on).format("MMM D, YYYY")})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1px",marginBottom:"2px"},children:[1,2,3,4,5].map(a=>e.jsx("span",{style:{fontSize:"12px",color:a<=t.rating?"#ffc107":"#ddd"},children:"★"},a))}),e.jsx("p",{style:{margin:0,fontSize:"10px",color:"#666"},children:S(t.rating)})]})]}),e.jsx("p",{className:"cusrev mb-0 pt-2",children:t.review})]},t._id)),o.length>3&&e.jsxs("button",{className:"view_all_revi",onClick:()=>m(`/reviews/${n}`),children:["View All Reviews (",o.length,")"]})]}):null,e.jsxs("button",{className:"mb-5 mt-4 book_servi",onClick:g,children:[e.jsx(Y,{}),"Book Now"]})]})]}),e.jsx(I,{show:y,onCancel:()=>d(!1),onConfirm:()=>{p(),d(!1)}})]})})]})};export{U as default};
