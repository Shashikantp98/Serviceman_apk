import{u as M,r as t,c as z,A as l,j as e,S as u,f as j,M as D,y as b}from"./index-Dsyms-5d.js";import{d as y}from"./dayjs.min-BQar3Thp.js";import{R as ee}from"./RazorpayPayment-xQdaLVQe.js";import{S as ae}from"./SuccessConfirmModal-CEB97olq.js";import{C as se}from"./credit-card-wh-t3cCz.js";import{A as te}from"./arrow-up-right-fXDEsvmj.js";import{C as L}from"./calendar-CC06YFwr.js";import"./Spinner-ChLPhxBd.js";import"./index-CA4HDCCN.js";const he=()=>{const c=M(),[s,B]=t.useState([]),[N,m]=t.useState([]),[R,p]=t.useState(!1),[o,_]=t.useState({id:"",action:""}),[A,v]=t.useState(0),[T,q]=t.useState(""),[E,P]=t.useState(""),[F,h]=t.useState(!1),[I,O]=t.useState(0),[W,H]=t.useState(0),[Y,f]=t.useState(!1),[S,U]=t.useState(!1),[V,G]=t.useState(""),i=z("booking-list"),d=z("dashboard-summary"),g=()=>{i.setLoading(!0),l.post("/servicemen/listBookingRequestsForServiceman",{filters:{},sorters:{created_on:-1},pagination:{page:1,pageSize:50}}).then(a=>{console.log(a),m(a.data.list)}).catch(a=>{console.error("Error fetching booking request:",a)}).finally(()=>{i.setLoading(!1)})},J=()=>{d.setLoading(!0),l.get("/servicemen/getServicemanSummary").then(a=>{O(a.data.wallet_balance),H(a.data.total_completed_bookings)}).catch(a=>{console.error("Error fetching wallet balance:",a)}).finally(()=>{d.setLoading(!1)})};t.useEffect(()=>{K(),J(),m([]),g();const a=n=>{console.log("ðŸ“¬ New booking notification received on Dashboard:",n.detail),g()};return window.addEventListener("newBookingReceived",a),()=>{window.removeEventListener("newBookingReceived",a)}},[]);const K=()=>{l.get("/servicemen/checkServicemanStatus").then(a=>{console.log(a),a.data.under_review==!0&&(f(!0),G(a.message)),a.data.profile_complete==!0&&U(!0)})},Q=()=>{l.post("/servicemen/getServicemenDetails",{}).then(a=>{console.log(a),B(a.data)})};t.useEffect(()=>{Q()},[]);const w=(a,n,x)=>{_({id:a,action:x}),l.post("/servicemen/respondToBooking",{booking_id:a,action:x,accepting_amount:n}).then(r=>{var k,C;b.success(r.message),x==="accept"?(h(!0),q((k=r.data)==null?void 0:k.booking_id),P((C=r.data)==null?void 0:C.razorpay_order_id)):(m([]),g())}).catch(r=>{b.error(r.response.data.message)}).finally(()=>{_({id:"",action:""})})},X=a=>{console.log("Payment Success:",a),l.post("/servicemen/verifyServicemanPayment",{razorpay_order_id:a.razorpay_order_id,razorpay_payment_id:a.razorpay_payment_id,razorpay_signature:a.razorpay_signature,booking_id:T}).then(n=>{console.log(n.data),p(!1),h(!1),setTimeout(()=>{window.location.reload()},1e3)}).catch(n=>{console.log(n),p(!1)})},Z=a=>{console.log("Payment Cancelled or Failed:",a),b.error("Payment Failed"),p(!1),h(!1)},$=()=>{f(!0),S?(localStorage.clear(),setTimeout(()=>{window.location.href="/"},1e3)):c("/editServicemen")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"container mb-5 pb-5",children:[e.jsx("div",{className:"row px-2 pt-3 fixed_header",children:e.jsxs("div",{className:"col-12 pt-2 ",style:{paddingLeft:"30px"},children:[e.jsxs("h1",{className:"head4",children:["Hello ðŸ‘‹"," ",s!=null&&s.fname?s==null?void 0:s.fname:s==null?void 0:s.phone_number]}),e.jsx("p",{className:"",children:"Welcome to instasevak"})]})}),e.jsxs("div",{className:"row px-2 main-content",children:[e.jsx("div",{className:"col-6 pt-2",children:e.jsxs("div",{className:"cards5",children:[e.jsx("span",{className:"ics bg_green",children:e.jsx(se,{})}),e.jsx("p",{className:"mb-1 font-12 mb-0 color-grey",children:"Wallet Balance"}),e.jsx("h3",{className:"font-18 mb-0",style:{minHeight:"24px"},children:d.loading?e.jsx(u,{show:!0,size:"medium",text:"",overlay:!1}):e.jsxs("b",{children:["â‚¹",I]})})]})}),e.jsx("div",{className:"col-6 pt-2",children:e.jsxs("div",{className:"cards5",children:[e.jsx("span",{className:"ics bg_green",children:e.jsx(te,{})}),e.jsx("p",{className:"mb-1 font-12 mb-0 color-grey",children:"Total Bookings"}),e.jsx("h3",{className:"font-18 mb-0",style:{minHeight:"24px"},children:d.loading?e.jsx(u,{show:!0,size:"medium",text:"",overlay:!1}):e.jsx("b",{children:W})})]})})]}),e.jsx("div",{className:"row px-2 pt-3 mt-1",children:e.jsx("div",{className:"col-12 pt-2",children:e.jsx("h1",{className:"head4",children:"Services Request"})})}),e.jsxs("div",{className:"row px-2",children:[e.jsx(u,{show:i.loading,size:"large",text:"Loading services...",overlay:!0}),e.jsx("div",{className:"col-12 pt-2",children:e.jsxs("div",{className:"tab-content",id:"pills-tabContent",children:[e.jsxs("div",{className:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab",children:[!i.loading&&N.length===0&&e.jsx("div",{className:"cards5 mb-2 text-center",style:{marginTop:"20px"},children:e.jsx("h2",{className:"mb-0 font-14",children:"No Booking Found"})}),!i.loading&&N.map(a=>e.jsxs("div",{className:"cards5 mb-2",children:[e.jsxs("div",{onClick:()=>c("/customerprojectinfo/"+a.booking_id),className:"d-flex align-items-center border-bottom pb-3 justify-content-between",children:[e.jsx("h2",{className:"mb-0 font-14",children:a.service_name}),e.jsx("p",{className:"color-yellow font-12 mb-0",style:{textTransform:"capitalize"},children:a.booking_status})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-3",onClick:()=>c("/customerprojectinfo/"+a.booking_id),children:[e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(L,{size:14}),"Scheduled for ",y(a.booking_date).format("DD MMM")]}),e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(j,{size:14}),a.booking_time]})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-3",onClick:()=>c("/customerprojectinfo/"+a.booking_id),children:[e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(D,{size:14}),"Distance ",a.distance]}),e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(j,{size:14}),a.duration]})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-3",onClick:()=>c("/customerprojectinfo/"+a.booking_id),children:[e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(L,{size:14}),"Booked on ",y(a.booked_on).format("DD MMM YYYY")]}),e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(j,{size:14}),y(a.booked_on).format("hh:mm A")]})]}),e.jsxs("div",{className:"pt-3",children:[e.jsx("button",{className:"canreq",disabled:o.id===a.booking_id&&o.action==="reject",onClick:()=>{v(a.accepting_fee),w(a.booking_id,a.accepting_fee,"reject")},children:o.id===a.booking_id&&o.action==="reject"?"Cancelling...":"Cancel Request"}),e.jsx("button",{className:"accreq",disabled:o.id===a.booking_id&&o.action==="accept",onClick:()=>{v(a.accepting_fee),w(a.booking_id,a.accepting_fee,"accept")},children:o.id===a.booking_id&&o.action==="accept"?"Accepting...":"Accept Request"})]})]},a.booking_id))]}),e.jsx("div",{className:"tab-pane fade",id:"pills-contact",role:"tabpanel","aria-labelledby":"pills-contact-tab",children:"..."}),e.jsx("div",{className:"tab-pane fade",id:"cancel",role:"tabpanel","aria-labelledby":"pills-contact-tab",children:"..."})]})})]}),e.jsx("div",{className:"row px-2 pt-3",children:e.jsx("div",{className:"col-12",children:e.jsx("button",{className:"fill",onClick:()=>c("/bookinghistory"),children:"View Booking History"})})}),F&&e.jsx(ee,{orderId:E,amount:A*100,name:(s==null?void 0:s.fname)+" "+(s==null?void 0:s.lname),email:s==null?void 0:s.email,contact:s==null?void 0:s.phone_number,onSuccess:X,onFailure:Z})]}),e.jsx(ae,{show:Y,onCancel:()=>f(!0),onConfirm:$,loading:R,itemName:s!=null&&s.fname?(s==null?void 0:s.fname)+" "+(s==null?void 0:s.lname):s.country_code+""+(s==null?void 0:s.phone_number),title:" ðŸ¥³ Thanks for joining Instasevak",description:V,confirmLabel:S?"Logout":"Edit Profile"})]})};export{he as default};
