import{u as W,r as t,c as X,A as u,j as e,S as Y,f as h,y as R}from"./index-Dsyms-5d.js";import{d as f}from"./dayjs.min-BQar3Thp.js";import{D as Z}from"./DeleteConfirmModal-CxuT43zh.js";import{R as $}from"./RazorpayPayment-xQdaLVQe.js";import{C as x}from"./calendar-CC06YFwr.js";import"./Spinner-ChLPhxBd.js";import"./index-CA4HDCCN.js";const le=()=>{var z,w,L,M;const d=W(),[j,b]=t.useState("in_progress"),[l,_]=t.useState([]),[P,g]=t.useState(!1),[y,q]=t.useState(""),[F,i]=t.useState(!1),[N,v]=t.useState(""),[k,S]=t.useState(""),[B,A]=t.useState(""),[O,p]=t.useState(!1),[s,E]=t.useState({}),[T,K]=t.useState(""),[n,U]=t.useState({}),c=X("booking-list"),C=()=>{c.setLoading(!0),u.post("/user/listUserBookings",{filters:{booking_status:j},sorters:{created_on:-1},pagination:{page:1,pageSize:50}}).then(a=>{console.log(a),_(a.data.bookings)}).catch(a=>{console.log(a)}).finally(()=>{c.setLoading(!1)})};t.useEffect(()=>{_([]),C()},[j]),t.useEffect(()=>{G()},[]);const G=()=>{u.post("/user/getCustomerDetails").then(a=>{console.log(a),E(a.data)}).catch(a=>{console.log(a)})},H=()=>{i(!0),v(y),u.post("/user/cancelBookingByCustomer",{booking_id:y}).then(a=>{console.log(a),R.success(a.data.message),i(!1),g(!1),C()}).catch(a=>{console.log(a),R.error(a.response.data.message),i(!1),g(!1)}).finally(()=>{v("")})},J=(a,r)=>{S(a),u.post("/user/payRemainingAmount",{booking_id:a,payment_amount:r}).then(o=>{var m,I;console.log(o),p(!0),K((m=o.data)==null?void 0:m.booking_id),A((I=o.data)==null?void 0:I.razorpay_order_id)}).catch(o=>{console.log(o)}).finally(()=>{S("")})},Q=a=>{console.log("Payment Success:",a),u.post("/user/verifyRemainingPayment",{razorpay_order_id:a.razorpay_order_id,razorpay_payment_id:a.razorpay_payment_id,razorpay_signature:a.razorpay_signature,booking_id:T}).then(r=>{var o,m;console.log(r.data),i(!1),p(!1),d("/succcess",{state:{name:((o=s==null?void 0:s.customer)==null?void 0:o.fname)+" "+((m=s==null?void 0:s.customer)==null?void 0:m.lname),service_name:n==null?void 0:n.service_name,booking_date:n==null?void 0:n.date,booking_time:n==null?void 0:n.time}}),setTimeout(()=>{window.location.reload()},1e3)}).catch(r=>{console.log(r),i(!1)})},V=a=>{console.log("Payment Cancelled or Failed:",a),alert("Payment Failed"),i(!1),p(!1)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"container main-content pt-2 pb-5",children:[e.jsx("div",{className:"fixed_header text-center",children:e.jsx("h1",{className:"head4",children:"My Request"})}),e.jsx("div",{className:"row px-2 mb-5 mb-5 fixed_header_padding",children:e.jsxs("div",{className:"col-12 pt-2",children:[e.jsxs("ul",{className:"nav nav-pills mb-3 border-bottom",id:"pills-tab",role:"tablist",children:[e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("button",{className:"nav-link active",id:"pills-home-tab","data-bs-toggle":"pill","data-bs-target":"#pills-home",type:"button",role:"tab","aria-controls":"pills-home","aria-selected":"true",onClick:()=>b("in_progress"),children:"In Progress"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("button",{className:"nav-link",id:"pills-contact-tab","data-bs-toggle":"pill","data-bs-target":"#pills-contact",type:"button",role:"tab","aria-controls":"pills-contact","aria-selected":"false",onClick:()=>b("completed"),children:"Complete"})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsx("button",{className:"nav-link",id:"pills-contact-tab","data-bs-toggle":"pill","data-bs-target":"#cancel",type:"button",role:"tab","aria-controls":"pills-contact","aria-selected":"false",onClick:()=>b("cancelled"),children:"Cancelled"})})]}),e.jsx(Y,{show:c.loading,size:"medium",text:"Loading your requests...",overlay:!0}),e.jsxs("div",{className:"tab-content",id:"pills-tabContent",children:[e.jsxs("div",{className:"tab-pane fade show active",id:"pills-home",role:"tabpanel","aria-labelledby":"pills-home-tab",children:[!c.loading&&l.length===0&&e.jsx("div",{className:"cards5 mb-2",children:e.jsx("div",{className:"d-flex align-items-center border-bottom pb-3 justify-content-between",children:e.jsx("h2",{className:"mb-0 font-14",children:"No Booking Found"})})}),l.map(a=>e.jsxs("div",{className:"cards5 mb-2",children:[e.jsxs("div",{onClick:()=>d("/customerprojectinfo/"+a.booking_id),className:"d-flex align-items-center border-bottom pb-3 justify-content-between",children:[e.jsx("h2",{className:"mb-0 font-14",children:a.service_name}),e.jsx("p",{className:"status-pending font-12 mb-0",style:{textTransform:"capitalize"},children:a.booking_status})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-3",onClick:()=>d("/customerprojectinfo/"+a.booking_id),children:[e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(x,{size:14}),"Scheduled for"," ",f(a.booking_date).format("DD MMM")]}),e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(h,{size:14}),a.booking_time]})]}),e.jsxs("div",{className:"pt-3",children:[e.jsx("button",{className:"canreq",disabled:N===a.booking_id,onClick:()=>{g(!0),q(a.booking_id)},children:N===a.booking_id?"Cancelling...":"Cancel Request"}),a.payment_status=="booking_fee_paid"&&e.jsx("button",{className:"canreq2",disabled:k===a.booking_id,onClick:()=>{U({service_name:a.service_name,date:a.booking_date,time:a.booking_time,total_amount:a.grand_total-a.booking_fee}),J(a.booking_id,(a.grand_total-a.booking_fee).toString())},children:k===a.booking_id?"Processing...":"Pay Full Amount"})]})]},a.booking_id))]}),e.jsxs("div",{className:"tab-pane fade",id:"pills-contact",role:"tabpanel","aria-labelledby":"pills-contact-tab",children:[!c.loading&&l.length===0&&e.jsx("div",{className:"cards5 mb-2",children:e.jsx("div",{className:"d-flex align-items-center border-bottom pb-3 justify-content-between",children:e.jsx("h2",{className:"mb-0 font-14",children:"No Booking Found"})})}),l.map(a=>e.jsxs("div",{className:"cards5 mb-2",onClick:()=>d("/customerprojectinfo/"+a.booking_id),children:[e.jsxs("div",{className:"d-flex align-items-center border-bottom pb-3 justify-content-between",children:[e.jsx("h2",{className:"mb-0 font-14",children:a.service_name}),e.jsx("p",{className:"status-completed font-12 mb-0",style:{textTransform:"capitalize"},children:a.booking_status})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(x,{size:14}),"Scheduled for"," ",f(a.booking_date).format("DD MMM")]}),e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(h,{size:14}),a.booking_time]})]}),e.jsx("div",{className:"pt-3"})]},a.booking_id))]}),e.jsxs("div",{className:"tab-pane fade",id:"cancel",role:"tabpanel","aria-labelledby":"pills-contact-tab",children:[!c.loading&&l.length===0&&e.jsx("div",{className:"cards5 mb-2",children:e.jsx("div",{className:"d-flex align-items-center border-bottom pb-3 justify-content-between",children:e.jsx("h2",{className:"mb-0 font-14",children:"No Booking Found"})})}),l.map(a=>e.jsxs("div",{className:"cards5 mb-2",onClick:()=>d("/customerprojectinfo/"+a.booking_id),children:[e.jsxs("div",{className:"d-flex align-items-center border-bottom pb-3 justify-content-between",children:[e.jsx("h2",{className:"mb-0 font-14",children:a.service_name}),e.jsx("p",{className:"status-cancelled font-12 mb-0",style:{textTransform:"capitalize"},children:a.booking_status})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-3",children:[e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(x,{size:14}),"Scheduled for"," ",f(a.booking_date).format("DD MMM")]}),e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(h,{size:14}),a.booking_time]})]}),e.jsx("div",{className:"pt-3"})]},a.booking_id))]})]}),e.jsx(Z,{show:P,onCancel:()=>g(!1),onConfirm:H,loading:F,itemName:"",title:"Cancel Request",description:"If you proceed, all associated data will be removed.",confirmLabel:"Cancel Request",cancelLabel:"Keep"})]})}),O&&e.jsx($,{orderId:B,amount:(n==null?void 0:n.total_amount)*100,name:((z=s==null?void 0:s.customer)==null?void 0:z.fname)+" "+((w=s==null?void 0:s.customer)==null?void 0:w.lname),email:(L=s==null?void 0:s.customer)==null?void 0:L.email,contact:(M=s==null?void 0:s.customer)==null?void 0:M.phone_primary,onSuccess:Q,onFailure:V})]})})};export{le as default};
