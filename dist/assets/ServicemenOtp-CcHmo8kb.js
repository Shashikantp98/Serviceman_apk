import{r as i,b as k,u as C,j as e,C as _,A as b,y as l}from"./index-Dsyms-5d.js";import{O as S}from"./otp-input-Dso3ECxF.js";const T=()=>{var g,y,j;const[a,v]=i.useState(""),u=k(),r=(g=u.state)==null?void 0:g.phone_number,p=(y=u.state)==null?void 0:y.country_code,d=(j=u.state)==null?void 0:j.user_type,[m,o]=i.useState(!1),f=C(),h=i.useRef(null),x=async t=>{var s,c;if(!m&&h.current!==t){h.current=t,o(!0);try{const n=await b.post("/user/verifyOtp",{phone_number:r,country_code:p,user_type:d,otp:t,fcm_token:""});o(!1),l.success(n.message),f("/setpin",{state:{phone_number:r,country_code:p,user_type:d,token:n.data.token}})}catch(n){console.log(n),l.error(((c=(s=n.response)==null?void 0:s.data)==null?void 0:c.message)||"OTP verification failed"),o(!1),h.current=null}}};i.useEffect(()=>{if(a.length===6){const t=setTimeout(()=>{x(a)},200);return()=>clearTimeout(t)}},[a]);const N=t=>{const s=t.replace(/\D/g,"");v(s)},O=()=>{const t={phone_number:r,country_code:p,user_type:d};o(!0),b.post("/user/sendOtp",t).then(s=>{l.success(s.message)}).catch(s=>{var c,n;l.error(((n=(c=s.response)==null?void 0:c.data)==null?void 0:n.message)||"Failed to resend OTP")}).finally(()=>{o(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute"},children:e.jsxs("button",{className:"back-btn mb-3 mt-5 px-3 py-3",style:{color:"#000"},onClick:()=>f(-1),children:[e.jsx(_,{})," Back"]})}),e.jsxs("div",{className:"px-5 pt-5 pb-3",children:[e.jsx("h3",{className:"head2 pt-5",children:"Enter verification code"}),e.jsxs("p",{className:"text-center color-grey font-12",children:["We have sent you a 6 digit verification code on ",e.jsxs("b",{children:["+91 ",r]})]})]}),e.jsx("div",{className:"otp",children:e.jsx(S,{length:6,onChange:N,className:"otp-input-container",inputClassName:"input"})}),e.jsxs("p",{className:"text-center color-grey font-12 pt-3",children:["Didn't receive? ",e.jsx("b",{onClick:O,children:"Resend"})]}),e.jsx("div",{className:"px-4 mt-5",children:e.jsx("button",{className:"fill_half",onClick:()=>x(a),disabled:a.length!==6||m,children:m?"Verifying...":"Verify"})})]})};export{T as default};
