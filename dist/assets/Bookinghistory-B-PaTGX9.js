import{u as _,r as n,c as C,j as e,S,f as h,M as L,A as b,y as N}from"./index-Dsyms-5d.js";import{d as A}from"./dayjs.min-BQar3Thp.js";import{S as w}from"./ServiceManHeader-u9im6dg3.js";import{C as B}from"./calendar-CC06YFwr.js";const R=()=>{const i=_(),[p,u]=n.useState([]),[t,d]=n.useState("in_progress"),c=C("booking-list"),[l,m]=n.useState(null),[o,g]=n.useState(!1),[x,j]=n.useState(null),f=()=>{c.setLoading(!0),b.post("/servicemen/listBookingsOfServiceman",{filters:{booking_status:t},sorters:{created_on:-1},pagination:{page:1,pageSize:50}}).then(s=>{u(s.data.list)}).catch(s=>{console.log("Error fetching bookings of serviceman",s)}).finally(()=>{c.setLoading(!1)})};n.useEffect(()=>{u([]),f()},[t]);const k=s=>{m(s),j("cancel"),g(!0),b.post("/servicemen/cancelBookingByServiceman",{booking_id:s}).then(a=>{const r=a;N.success(r.message),f()}).catch(a=>{var r,v;N.error(((v=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:v.message)||"Error")}).finally(()=>{g(!1),m(null)})},y=s=>{if(t==="cancelled")return"status-cancelled";switch(s){case"completed":return"status-completed";case"cancelled":return"status-cancelled";default:return"status-pending"}};return e.jsxs(e.Fragment,{children:[e.jsx(w,{title:"Booking History"}),e.jsxs("div",{className:"container mb-5 pb-5 main-content-service",children:[e.jsx("div",{className:"row px-2 pt-3 mt-1"}),e.jsx("div",{className:"row px-2",children:e.jsxs("div",{className:"col-12 pt-2",children:[e.jsxs("ul",{className:"nav nav-pills mb-3 border-bottom",children:[e.jsx("li",{className:"nav-item",children:e.jsx("button",{onClick:()=>d("in_progress"),className:`nav-link ${t==="in_progress"?"active":""}`,type:"button",children:"In Progress"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{onClick:()=>d("completed"),className:`nav-link ${t==="completed"?"active":""}`,type:"button",children:"Completed"})}),e.jsx("li",{className:"nav-item",children:e.jsx("button",{onClick:()=>d("cancelled"),className:`nav-link ${t==="cancelled"?"active":""}`,type:"button",children:"Cancelled"})})]}),e.jsx(S,{show:c.loading,size:"medium",text:"Loading your requests...",overlay:!0}),e.jsxs("div",{className:"tab-content",children:[!c.loading&&p.length===0&&e.jsx("div",{className:"cards5 mb-2",children:e.jsx("div",{className:"d-flex align-items-center border-bottom pb-3 justify-content-between",children:e.jsx("h2",{className:"mb-0 font-14",children:"No Booking Found"})})}),p.map(s=>e.jsxs("div",{className:"cards5 mb-2",children:[e.jsxs("div",{onClick:()=>i("/projectinfo/"+s.booking_id),className:"d-flex align-items-center border-bottom pb-3 justify-content-between",children:[e.jsx("h2",{className:"mb-0 font-14",children:s.service_name}),e.jsx("p",{className:`${y(s.booking_status)} font-12 mb-0`,style:{textTransform:"capitalize"},children:t==="cancelled"?"cancelled":s.booking_status})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-3",onClick:()=>i("/projectinfo/"+s.booking_id),children:[e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(B,{size:14}),"Scheduled for ",A(s.booking_date).format("DD MMM")]}),e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(h,{size:14}),s.booking_time]})]}),e.jsxs("div",{className:"d-flex justify-content-between pt-3",onClick:()=>i("/projectinfo/"+s.booking_id),children:[e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(L,{size:14}),"Distance ",s.distance]}),e.jsxs("div",{className:"d-flex align-items-center gap-10 font-12 color-grey",children:[e.jsx(h,{size:14}),s.duration]})]}),t==="in_progress"&&e.jsxs("div",{className:"pt-3",children:[e.jsx("button",{className:"canreq",disabled:o&&l===s.booking_id,onClick:()=>k(s.booking_id),children:o&&l===s.booking_id&&x==="cancel"?"Cancelling...":"Cancel Request"}),e.jsx("button",{className:"accreq",disabled:o&&l===s.booking_id,onClick:()=>{m(s.booking_id),j("complete"),i("/capture/"+s.booking_id)},children:o&&l===s.booking_id&&x==="complete"?"Completing...":"Complete"})]})]},s.booking_id))]})]})})]})]})};export{R as default};
