import{u as ce,b as oe,a as le,r as p,A as H,j as e,C as de,y as me}from"./index-DEIqmbY-.js";import{u as ue,I as d,o as pe,c as K,b as Q,d as he,a as i}from"./index.esm-CAr2bw5T.js";import{C as v,a as N,M as be}from"./MultiSelect-B3fnxjps.js";import{F as W}from"./FileInput-B9h8R-UV.js";import{S as fe}from"./SuccessConfirmModal-CzD1i22h.js";import"./file-CP6wb8cz.js";import"./Spinner-YBZ7XAN5.js";import"./index-C6PswM7T.js";const xe=K().shape({fname:i().required("First name is required"),lname:i(),service_ids:he().of(i().required("Invalid service ID")).min(1,"At least one service required").required("Service IDs are required"),bank:K({upi_id:i().trim().test("isValidUPI","Invalid UPI ID format",s=>s?/^[\w.-]{2,}@[\w.-]{2,}$/.test(s):!0).nullable(),account_name:i().when("upi_id",{is:s=>!s,then:s=>s.required("Account name is required"),otherwise:s=>s.notRequired()}),bank_name:i().when("upi_id",{is:s=>!s,then:s=>s.required("Bank name is required"),otherwise:s=>s.notRequired()}),account_number:i().when("upi_id",{is:s=>!s,then:s=>s.required("Account number is required").matches(/^[0-9]{9,18}$/,"Account number must be 9â€“18 digits"),otherwise:s=>s.notRequired()}),ifsc_code:i().when("upi_id",{is:s=>!s,then:s=>s.required("IFSC code is required").matches(/^[A-Za-z]{4}\d{7}$/,"Invalid IFSC format"),otherwise:s=>s.notRequired()})}).test("upiOrBank","Either UPI ID or bank details required",s=>{const{upi_id:n,account_name:m,bank_name:j,account_number:b,ifsc_code:c}=s||{};return!!n||!!m&&!!j&&!!b&&!!c}),profile_image:Q().test("fileRequired","Profile image is required",s=>s instanceof FileList&&s.length>0).test("fileType","Invalid document type",s=>{if(!s||s.length===0)return!1;const n=s[0];return["application/pdf","image/jpeg","image/png"].includes(n.type)}),serviceman_document:Q().test("fileRequired","Serviceman document is required",s=>s instanceof FileList&&s.length>0).test("fileType","Invalid document type",s=>{if(!s||s.length===0)return!1;const n=s[0];return["application/pdf","image/jpeg","image/png"].includes(n.type)})}),Ie=()=>{var w,C,q,A,F,P,E,U,B,D,L,R,T,O,$,M,z,V,G,J,Y;const s=ce(),n=oe(),{login:m}=le(),[j,b]=p.useState(!1),c=(w=n.state)==null?void 0:w.token,_=(C=n.state)==null?void 0:C.phone_number,y=(q=n.state)==null?void 0:q.country_code,S=(A=n.state)==null?void 0:A.user_type,[X,k]=p.useState(!1),[r,g]=p.useState("general"),[f,I]=p.useState("bank"),{handleSubmit:ee,control:t,setValue:h,formState:{errors:a}}=ue({resolver:pe(xe),defaultValues:{service_ids:[],bank:{account_name:"",bank_name:"",account_number:"",ifsc_code:"",upi_id:""}}}),[se,ae]=p.useState([]);p.useEffect(()=>{H.post("/servicemen/listServicesForServiceman",{},{headers:{Authorization:`Bearer ${c}`}}).then(u=>{ae(u.data.list)})},[c]);const ne=se.map(u=>({label:u.service_name,value:u.service_id})),te=u=>{const x=new FormData;Object.entries(u).forEach(([o,l])=>{o==="profile_image"||o==="serviceman_document"?x.append(o,l[0]):typeof l=="object"?x.append(o,JSON.stringify(l)):x.append(o,String(l))}),k(!0),H.post("/servicemen/editServicemen",x,{headers:{Authorization:`Bearer ${c}`}}).then(()=>{k(!1),m(c,S),s("/dashboard")}).catch(o=>{var l,Z;me.error(((Z=(l=o.response)==null?void 0:l.data)==null?void 0:Z.message)||"Error submitting form"),k(!1)})},re=()=>{b(!1),s("/")},ie=()=>{m(c,S),s("/dashboard")};return e.jsxs("div",{className:"container py-4",children:[e.jsxs("button",{className:"back-btn mb-3 px-3 py-3",style:{color:"#000"},onClick:()=>s(-1),children:[e.jsx(de,{})," Back"]}),e.jsx("h6",{className:"text-center mb-4",children:"Servicemen Registration"}),e.jsxs("div",{className:"accordion",children:[e.jsxs("div",{className:"accordion-item mb-3 border rounded p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",onClick:()=>g(r==="general"?"none":"general"),style:{cursor:"pointer"},children:[e.jsx("h6",{className:"m-0",children:"General Info"}),r==="general"?e.jsx(v,{}):e.jsx(N,{})]}),r==="general"&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 pt-3",children:e.jsx(d,{label:"First Name",control:t,name:"fname",type:"text",placeholder:"Enter First Name",error:(F=a.fname)==null?void 0:F.message})}),e.jsx("div",{className:"col-12 pt-3",children:e.jsx(d,{label:"Last Name",control:t,name:"lname",type:"text",placeholder:"Enter Last Name",error:(P=a.lname)==null?void 0:P.message})}),e.jsx("div",{className:"col-12 pt-3",children:e.jsx(be,{label:"Service Type",control:t,name:"service_ids",options:ne,error:(E=a.service_ids)==null?void 0:E.message})}),e.jsx("div",{className:"col-12 pt-1",children:e.jsx(W,{label:"Upload Profile Image",name:"profile_image",control:t,error:(U=a.profile_image)==null?void 0:U.message})})]})})]}),e.jsxs("div",{className:"accordion-item mb-3 border rounded p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",onClick:()=>g(r==="bank"?"none":"bank"),style:{cursor:"pointer"},children:[e.jsx("h6",{className:"m-0",children:"Banking Info"}),r==="bank"?e.jsx(v,{}):e.jsx(N,{})]}),r==="bank"&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("label",{className:"lbl2 d-block mb-2",children:"Select Payment Method"}),e.jsxs("div",{className:"d-flex gap-4",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"radio",className:"form-check-input",id:"upiOption",name:"payment_type",checked:f==="upi",onChange:()=>{I("upi"),h("bank.account_name",""),h("bank.bank_name",""),h("bank.account_number",""),h("bank.ifsc_code","")}}),e.jsx("label",{htmlFor:"upiOption",className:"form-check-label font-14",children:"UPI ID"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"radio",className:"form-check-input",id:"bankOption",name:"payment_type",checked:f==="bank",onChange:()=>{I("bank"),h("bank.upi_id","")}}),e.jsx("label",{htmlFor:"bankOption",className:"form-check-label font-14",children:"Bank Account"})]})]})]}),((B=a.bank)==null?void 0:B.message)&&e.jsx("div",{className:"col-12 pt-3",children:e.jsx("div",{className:"alert alert-danger py-2",children:(D=a.bank)==null?void 0:D.message})}),f==="upi"&&e.jsx("div",{className:"col-12 pt-3",children:e.jsxs("div",{className:"",children:[e.jsx(d,{label:"UPI ID",control:t,name:"bank.upi_id",type:"text",placeholder:"example@bank",error:(R=(L=a.bank)==null?void 0:L.upi_id)==null?void 0:R.message}),e.jsx("p",{className:"text-muted font-12 mt-2",children:"Enter your valid UPI handle (e.g. name@bank)"})]})}),f==="bank"&&e.jsx("div",{className:"col-12 pt-3",children:e.jsxs("div",{className:"bnkboxf",children:[e.jsx(d,{label:"Account Name",control:t,name:"bank.account_name",type:"text",placeholder:"Enter Account Name",error:(O=(T=a.bank)==null?void 0:T.account_name)==null?void 0:O.message}),e.jsx(d,{label:"Bank Name",control:t,name:"bank.bank_name",type:"text",placeholder:"Enter Bank Name",error:(M=($=a.bank)==null?void 0:$.bank_name)==null?void 0:M.message}),e.jsx(d,{label:"Account Number",control:t,name:"bank.account_number",type:"text",inputMode:"numeric",placeholder:"Enter Account Number",error:(V=(z=a.bank)==null?void 0:z.account_number)==null?void 0:V.message}),e.jsx(d,{label:"IFSC Code",control:t,name:"bank.ifsc_code",type:"text",placeholder:"Enter IFSC Code",error:(J=(G=a.bank)==null?void 0:G.ifsc_code)==null?void 0:J.message})]})})]})})]}),e.jsxs("div",{className:"accordion-item mb-3 border rounded p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",onClick:()=>g(r==="docs"?"none":"docs"),style:{cursor:"pointer"},children:[e.jsx("h6",{className:"m-0",children:"Docs Upload"}),r==="docs"?e.jsx(v,{}):e.jsx(N,{})]}),r==="docs"&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12 pt-3",children:e.jsx(W,{label:"Upload Aadhar / PAN Card",name:"serviceman_document",control:t,error:(Y=a.serviceman_document)==null?void 0:Y.message})})})})]}),e.jsxs("div",{className:"text-center mt-4",children:[e.jsx("button",{onClick:ee(te),className:"fill",children:"Register Profile"}),e.jsx("button",{onClick:ie,className:"fill mt-2",children:"Skip"})]})]}),e.jsx(fe,{show:j,onCancel:()=>b(!1),onConfirm:re,loading:X,itemName:y+_,title:" ðŸ¥³ Thanks for joining Instasevak",description:"Your account has been registered successfully.",confirmLabel:"Close"})]})};export{Ie as default};
