import{a as w,r as o,b as S,u as E,R as L,j as e,C as R,A as j}from"./index-Dsyms-5d.js";import{O as _}from"./otp-input-Dso3ECxF.js";const A=()=>{var x,k;const{login:y}=w(),[a,m]=o.useState(""),[d,p]=o.useState(null),f=S(),N=(x=f.state)==null?void 0:x.phone_number,s=(k=f.state)==null?void 0:k.user_type,[i,l]=o.useState(!1),[h,v]=o.useState(!1),c=E(),u=o.useRef(null);L.useEffect(()=>{const t=()=>{window.fcmToken&&window.fcmToken!==""?v(!0):setTimeout(t,500)};t()},[]);const g=async t=>{var r,b;if(!i&&u.current!==t){u.current=t,l(!0),p(null);try{const n=window.fcmToken||"";console.log("Logging in with FCM Token:",n);const T=await j.post("/user/loginUser",{phone_number:N,pin:t,user_type:s,fcm_token:n});l(!1),y(T.data.token,s),await j.post("/user/updateFcmToken",{fcm_token:n,user_type:s}),s==="customer"&&c("/home"),s==="servicemen"&&c("/dashboard")}catch(n){console.log(n),p(((b=(r=n.response)==null?void 0:r.data)==null?void 0:b.message)||"Login failed"),m(""),l(!1),u.current=null}}};o.useEffect(()=>{if(a.length===6){const t=setTimeout(()=>{g(a)},200);return()=>clearTimeout(t)}},[a]);const C=t=>{const r=t.replace(/\D/g,"");m(r)};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{position:"absolute"},children:e.jsxs("button",{className:"back-btn mb-3 mt-5 px-3 py-3",style:{color:"#000"},onClick:()=>c(-1),children:[e.jsx(R,{})," Back"]})}),e.jsxs("div",{className:"px-5 pt-5 pb-3",children:[e.jsx("h3",{className:"head2 pt-5",children:"Enter Pin"}),e.jsx("p",{className:"text-center color-grey font-12",children:"Enter your pin for login and security"})]}),e.jsx("div",{className:"otp",children:e.jsx(_,{length:6,onChange:C,className:"otp-input-container",inputClassName:"input"})}),d&&e.jsx("p",{className:"text-danger font-14 mt-1 text-center",children:d}),e.jsx("p",{className:"para2 mb-1 mt-4",style:{display:"flex",justifyContent:"center"},children:e.jsxs("b",{className:"text-black d-block pt-1",children:["Forgot PIN?"," ",e.jsx("span",{className:"text-decoration-underline",onClick:()=>c("/forgot-phone",{state:{role:s}}),children:"Click here"})]})}),e.jsx("div",{className:"px-4 mt-5",children:e.jsx("button",{className:"fill_half",onClick:()=>g(a),disabled:a.length!==6||i||!h,children:h?i?"Login...":"Login":"Getting device token..."})})]})};export{A as default};
