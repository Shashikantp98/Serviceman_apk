import{u as ke,r as o,c as Se,A as w,j as e,e as qe,n as we,G as Ie,y as ue}from"./index-DEIqmbY-.js";import{u as Ae,I as u,o as Le,c as S,b as pe,d as Pe,a as r}from"./index.esm-CAr2bw5T.js";import{C as j,a as _,M as Ce}from"./MultiSelect-B3fnxjps.js";import{F as he}from"./FileInput-B9h8R-UV.js";import{G as fe}from"./GooglePlacesAutocomplete-82yjwKBa.js";import{u as De}from"./esm-4GqwfAtj.js";import"./file-CP6wb8cz.js";import"./index-C6PswM7T.js";const Ee=S().shape({fname:r().required("First name is required"),lname:r(),email:r().nullable().trim().test("is-valid-email","Invalid email",t=>!t||r().email().isValidSync(t)),service_ids:Pe().of(r().required("Invalid service ID")).min(1,"At least one service required").required("Service IDs are required"),address:S().shape({street_1:r().required("Street is required"),city:r().required("City is required"),state:r().required("State is required"),country:r().required("Country is required"),zip:r().required("Zip code is required")}),home_address:S().shape({street_1:r().required("Street is required"),city:r().required("City is required"),state:r().required("State is required"),country:r().required("Country is required"),zip:r().required("Zip code is required")}),bank:S({upi_id:r().trim().test("isValidUPI","Invalid UPI ID format",t=>t?/^[\w.-]{2,}@[\w.-]{2,}$/.test(t):!0).nullable(),account_name:r().when("upi_id",{is:t=>!t,then:t=>t.required("Account name is required"),otherwise:t=>t.notRequired()}),bank_name:r().when("upi_id",{is:t=>!t,then:t=>t.required("Bank name is required"),otherwise:t=>t.notRequired()}),account_number:r().when("upi_id",{is:t=>!t,then:t=>t.required("Account number is required").matches(/^[0-9]{9,18}$/,"Account number must be 9–18 digits"),otherwise:t=>t.notRequired()}),ifsc_code:r().when("upi_id",{is:t=>!t,then:t=>t.required("IFSC code is required").matches(/^[A-Za-z]{4}\d{7}$/,"Invalid IFSC format"),otherwise:t=>t.notRequired()})}).test("upiOrBank","Either UPI ID or bank details required",t=>{const{upi_id:i,account_name:c,bank_name:x,account_number:v,ifsc_code:g}=t||{};return!!i||!!c&&!!x&&!!v&&!!g}),profile_image:pe().test("fileOrUrl","Profile image is required",t=>typeof t=="string"&&t.trim()!==""||t instanceof FileList&&t.length>0).test("fileType","Invalid profile image type",t=>{if(typeof t=="string")return!0;if(!t||t.length===0)return!1;const i=t[0];return["application/pdf","image/jpeg","image/png"].includes(i.type)}),serviceman_document:pe().test("fileOrUrl","Document is required",t=>typeof t=="string"&&t.trim()!==""||t instanceof FileList&&t.length>0).test("fileType","Invalid document type",t=>{if(typeof t=="string")return!0;if(!t||t.length===0)return!1;const i=t[0];return["application/pdf","image/jpeg","image/png"].includes(i.type)})}),Me=()=>{var P,C,D,E,U,F,O,R,V,z,T,B,M,$,G,Z,H,K,J,Y,Q,W,X;const t=ke(),[i,c]=o.useState("general"),[x,v]=o.useState("bank"),g=Se("serviceman-edit"),I=()=>{g.setLoading(!0),w.post("/servicemen/getServicemenDetails").then(s=>{console.log(s),n("fname",s.data.fname),n("lname",s.data.lname),n("email",s.data.email),s.data.service_location&&n("address",s.data.service_location),n("home_address",s.data.home_address),n("bank",s.data.bank_details);var m=[];s.data.services.map(l=>{m.push(l._id)}),n("service_ids",m),s.data.documents&&s.data.documents.length>0&&n("serviceman_document",s.data.documents[0].file_url),s.data.profile_image&&n("profile_image",s.data.profile_image)}).catch(s=>{console.log(s)}).finally(()=>{g.setLoading(!1)})};o.useEffect(()=>{I()},[]);const[p,q]=o.useState(!1),{handleSubmit:be,control:d,setValue:n,formState:{errors:a},watch:A}=Ae({resolver:Le(Ee),defaultValues:{service_ids:[],address:{street_1:"",city:"",state:"",country:"",zip:""},home_address:{street_1:"",city:"",state:"",country:"",zip:""},bank:{account_name:"",bank_name:"",account_number:"",ifsc_code:"",upi_id:""}}});console.log(a);const[L,y]=o.useState(null),[N,k]=o.useState(null),h=A("profile_image"),f=A("serviceman_document");o.useEffect(()=>{let s=null;if(!h){y(null);return}if(typeof h=="string"){y(h);return}return h instanceof FileList&&h.length>0?(s=URL.createObjectURL(h[0]),y(s)):y(null),()=>{s&&URL.revokeObjectURL(s)}},[h]),o.useEffect(()=>{let s=null;if(!f){k(null);return}if(typeof f=="string"){k(f);return}return f instanceof FileList&&f.length>0?(s=URL.createObjectURL(f[0]),k(s)):k(null),()=>{s&&URL.revokeObjectURL(s)}},[f]);const xe=s=>{const m=new FormData;Object.entries(s).forEach(([l,b])=>{l==="profile_image"||l==="serviceman_document"?m.append(l,b[0]):typeof b=="object"?m.append(l,JSON.stringify(b)):m.append(l,String(b))}),console.log("✅ Final FormData (to send via API):",s),q(!0),w.post("/servicemen/editServicemen",m).then(l=>{console.log(l),q(!1),ue.success(l.message),t(-1)}).catch(l=>{console.log(l),ue.error(l.response.data.message),q(!1)})},[ge,je]=o.useState([]);o.useEffect(()=>{w.post("/servicemen/listServicesForServiceman",{}).then(s=>{console.log(s),je(s.data.list)})},[]);const _e=ge.map(s=>({label:s.service_name,value:s.service_id})),ve=s=>{console.log("Selected Address:",s),n("home_address.street_1",s.fullAddress,{shouldValidate:!0,shouldDirty:!0}),s.city&&n("home_address.city",s.city,{shouldValidate:!0,shouldDirty:!0}),s.state&&n("home_address.state",s.state,{shouldValidate:!0,shouldDirty:!0}),s.postalCode&&n("home_address.zip",s.postalCode,{shouldValidate:!0,shouldDirty:!0}),s.country&&n("home_address.country",s.country,{shouldValidate:!0,shouldDirty:!0})};o.useEffect(()=>{var s,m,l,b,ee,se,te,ae,ie,re,ne,le,ce,de,oe,me;a&&(a.fname||a.lname||a.email||a.service_ids||a.profile_image?c("general"):(s=a.home_address)!=null&&s.street_1||(m=a.home_address)!=null&&m.city||(l=a.home_address)!=null&&l.state||(b=a.home_address)!=null&&b.country||(ee=a.home_address)!=null&&ee.zip?c("home_address"):(se=a.address)!=null&&se.street_1||(te=a.address)!=null&&te.city||(ae=a.address)!=null&&ae.state||(ie=a.address)!=null&&ie.country||(re=a.address)!=null&&re.zip?c("service_address"):(ne=a.bank)!=null&&ne.upi_id||(le=a.bank)!=null&&le.account_name||(ce=a.bank)!=null&&ce.bank_name||(de=a.bank)!=null&&de.account_number||(oe=a.bank)!=null&&oe.ifsc_code||(me=a.bank)!=null&&me.message?c("bank"):a.serviceman_document&&c("docs"))},[a]);const ye=s=>{console.log("Selected Address:",s),n("address.street_1",s.fullAddress,{shouldValidate:!0,shouldDirty:!0}),s.city&&n("address.city",s.city,{shouldValidate:!0,shouldDirty:!0}),s.state&&n("address.state",s.state,{shouldValidate:!0,shouldDirty:!0}),s.postalCode&&n("address.zip",s.postalCode,{shouldValidate:!0,shouldDirty:!0}),s.country&&n("address.country",s.country,{shouldValidate:!0,shouldDirty:!0})},{isLoaded:Ne}=De({googleMapsApiKey:Ie,libraries:["places"]});return Ne?e.jsxs(e.Fragment,{children:[e.jsx(qe,{}),e.jsxs("div",{className:"container mb-8 main-content-service",children:[g.loading&&e.jsxs("div",{className:"full-page-loader",children:[e.jsx("div",{className:"loader-spinner"}),e.jsx("p",{children:"Loading Profile details..."})]}),e.jsx("div",{className:"row pt-4",children:e.jsx("div",{className:"col-12 text-center pb-3",children:e.jsx("h6",{className:"head4",children:"Edit Profile"})})}),e.jsxs("div",{className:"accordion",children:[e.jsxs("div",{className:"accordion-item mb-3 border rounded p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",onClick:()=>c(i==="general"?"none":"general"),style:{cursor:"pointer"},children:[e.jsx("h6",{className:"m-0",children:"General Info"}),i==="general"?e.jsx(j,{}):e.jsx(_,{})]}),i==="general"&&e.jsxs("div",{className:"row px-3 pt-3",children:[e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("label",{className:"lbl2",children:"First Name"}),e.jsx(u,{control:d,name:"fname",label:"",type:"text",placeholder:"Enter First Name",inputMode:"text",error:(P=a.fname)==null?void 0:P.message,disabled:p})]}),e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("label",{className:"lbl2",children:"Last Name"}),e.jsx(u,{control:d,name:"lname",label:"",type:"text",placeholder:"Enter Last Name",inputMode:"text",error:(C=a.lname)==null?void 0:C.message,disabled:p})]}),e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("label",{className:"lbl2",children:"Email"}),e.jsx(u,{control:d,name:"email",label:"",type:"text",placeholder:"Enter Email",inputMode:"text",error:(D=a.email)==null?void 0:D.message,disabled:p})]}),e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("label",{className:"lbl2",children:"Service Type"}),e.jsx(Ce,{control:d,name:"service_ids",label:"",options:_e,error:(E=a.service_ids)==null?void 0:E.message,disabled:p})]}),e.jsxs("div",{className:"col-12 pt-1",children:[e.jsx(he,{label:"Upload Profile Image",name:"profile_image",control:d,error:(U=a.profile_image)==null?void 0:U.message}),e.jsx("div",{className:"col-12 pt-2",style:{textAlign:"center"},children:L&&e.jsx("img",{style:{height:"120px",width:"120px",borderRadius:8},src:L,alt:"Profile preview",className:"img-fluid"})})]})]})]}),e.jsxs("div",{className:"accordion-item mb-3 border rounded p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",onClick:()=>c(i==="home_address"?"none":"home_address"),style:{cursor:"pointer"},children:[e.jsx("h6",{className:"m-0",children:"Home Address"}),i==="home_address"?e.jsx(j,{}):e.jsx(_,{})]}),i==="home_address"&&e.jsx("div",{className:"col-12 pt-3",children:e.jsx(fe,{control:d,name:"home_address.street_1",onSelect:ve,label:"",error:(R=(O=(F=a.home_address)==null?void 0:F.street_1)==null?void 0:O.message)==null?void 0:R.toString()})})]}),e.jsxs("div",{className:"accordion-item mb-3 border rounded p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",onClick:()=>c(i==="service_address"?"none":"service_address"),style:{cursor:"pointer"},children:[e.jsx("h6",{className:"m-0",children:"Service Address"}),i==="service_address"?e.jsx(j,{}):e.jsx(_,{})]}),i==="service_address"&&e.jsx("div",{className:"col-12 pt-3",children:e.jsx(fe,{control:d,name:"address.street_1",onSelect:ye,label:"",error:(z=(V=a.address)==null?void 0:V.message)==null?void 0:z.toString()})})]}),e.jsxs("div",{className:"accordion-item mb-3 border rounded p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",onClick:()=>c(i==="bank"?"none":"bank"),style:{cursor:"pointer"},children:[e.jsx("h6",{className:"m-0",children:"Banking Info"}),i==="bank"?e.jsx(j,{}):e.jsx(_,{})]}),i==="bank"&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("label",{className:"lbl2 d-block mb-2",children:"Select Payment Method"}),e.jsxs("div",{className:"d-flex gap-4",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"radio",className:"form-check-input",id:"upiOption",name:"payment_type",checked:x==="upi",onChange:()=>{v("upi")}}),e.jsx("label",{htmlFor:"upiOption",className:"form-check-label font-14",children:"UPI ID"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"radio",className:"form-check-input",id:"bankOption",name:"payment_type",checked:x==="bank",onChange:()=>{v("bank")}}),e.jsx("label",{htmlFor:"bankOption",className:"form-check-label font-14",children:"Bank Account"})]})]})]}),((T=a.bank)==null?void 0:T.message)&&e.jsx("div",{className:"col-12 pt-3",children:e.jsx("div",{className:"alert alert-danger py-2",children:(B=a.bank)==null?void 0:B.message})}),x==="upi"&&e.jsx("div",{className:"col-12 pt-3",children:e.jsxs("div",{className:"",children:[e.jsx(u,{label:"UPI ID",control:d,name:"bank.upi_id",type:"text",placeholder:"example@bank",error:($=(M=a.bank)==null?void 0:M.upi_id)==null?void 0:$.message}),e.jsx("p",{className:"text-muted font-12 mt-2",children:"Enter your valid UPI handle (e.g. name@bank)"})]})}),x==="bank"&&e.jsx("div",{className:"col-12 pt-3",children:e.jsxs("div",{className:"",children:[e.jsx(u,{label:"Account Name",control:d,name:"bank.account_name",type:"text",placeholder:"Enter Account Name",error:(Z=(G=a.bank)==null?void 0:G.account_name)==null?void 0:Z.message}),e.jsx(u,{label:"Bank Name",control:d,name:"bank.bank_name",type:"text",placeholder:"Enter Bank Name",error:(K=(H=a.bank)==null?void 0:H.bank_name)==null?void 0:K.message}),e.jsx(u,{label:"Account Number",control:d,name:"bank.account_number",type:"text",inputMode:"numeric",placeholder:"Enter Account Number",error:(Y=(J=a.bank)==null?void 0:J.account_number)==null?void 0:Y.message}),e.jsx(u,{label:"IFSC Code",control:d,name:"bank.ifsc_code",type:"text",placeholder:"Enter IFSC Code",error:(W=(Q=a.bank)==null?void 0:Q.ifsc_code)==null?void 0:W.message})]})})]})})]}),e.jsxs("div",{className:"accordion-item mb-3 border rounded p-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",onClick:()=>c(i==="docs"?"none":"docs"),style:{cursor:"pointer"},children:[e.jsx("h6",{className:"m-0",children:"Docs Upload"}),i==="docs"?e.jsx(j,{}):e.jsx(_,{})]}),i==="docs"&&e.jsx("div",{className:"mt-3",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx(he,{label:"Upload Aadhar / PAN Card",name:"serviceman_document",control:d,error:(X=a.serviceman_document)==null?void 0:X.message}),e.jsx("div",{className:"col-12 pt-2",style:{textAlign:"center"},children:N&&(/\.(jpe?g|png|gif|webp|bmp)$/i.test(N)?e.jsx("img",{style:{height:"120px",width:"240px",objectFit:"contain"},src:N,alt:"Document preview",className:"img-fluid"}):e.jsxs("p",{className:"font-12 text-secondary mb-0 pt-1",children:[e.jsx(we,{size:14})," ",e.jsx("a",{href:N,target:"_blank",rel:"noreferrer",children:"Open document"})]}))})]})})})]})]}),e.jsx("div",{className:"row  pt-3",children:e.jsx("div",{className:"col-12",children:e.jsx("button",{onClick:be(xe),disabled:p,className:"fill",children:p?"Loading...":"Update Profile"})})})]})]}):e.jsx("p",{children:"Loading..."})};export{Me as default};
