import{u as w,b as z,r as u,a as x,j as a,C as E,G as $,A as j,y as l}from"./index-DEIqmbY-.js";import{G as B}from"./GoogleMapComponent-D7VrRrP3.js";import"./esm-4GqwfAtj.js";import"./index-C6PswM7T.js";const I=()=>{var y,_,b;const o=w(),i=z(),N=(y=i.state)==null?void 0:y.id,L=(_=i.state)==null?void 0:_.isGuest,v=(b=i.state)==null?void 0:b.role,[A,n]=u.useState(!1),{latitude:d,longitude:m,token:g,setCurrentLocationFn:p,login:C}=x(),{setLatLong:h}=x(),[s,k]=u.useState(d&&m?{lat:Number(d),lng:Number(m)}:{lat:28.6139,lng:77.209}),[e,f]=u.useState({street_1:"",city:"",state:"",zip:"",country:""}),G=async()=>{if(!(s!=null&&s.lat)||!(s!=null&&s.lng))return;const t=await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${s==null?void 0:s.lat},${s==null?void 0:s.lng}&key=${$}`)).json();f({street_1:t.results[0].address_components[0].long_name,city:t.results[0].address_components[1].long_name,state:t.results[0].address_components[2].long_name,zip:t.results[0].address_components[3].long_name,country:t.results[0].address_components[4].long_name})};u.useEffect(()=>{s!=null&&s.lat&&(s!=null&&s.lng)&&G()},[s]);const S=()=>{if(L)h(Number(s==null?void 0:s.lat),Number(s==null?void 0:s.lng)),p(e.street_1+", "+e.city+", "+e.state+", "+e.country),C("guest",v),o("/home");else if(g=="guest")h(Number(s==null?void 0:s.lat),Number(s==null?void 0:s.lng)),p(e.street_1+", "+e.city+", "+e.state+", "+e.country),o("/home");else if(n(!0),N)j.post("/user/addCustomerAddress",e).then(t=>{console.log(t),l.success(t.message),n(!1),o(-1)}).catch(t=>{console.log(t),l.error(t.response.data.message),n(!1)});else{const c=new FormData;c.append("address",JSON.stringify({street_1:e.street_1+", "+e.city+", "+e.state+", "+e.country,city:e.city,state:e.state,country:e.country,zip:e.zip})),j.post("/user/updateCustomerDetails",c,{headers:{Authorization:`Bearer ${g}`}}).then(r=>{console.log(r),l.success(r.message),n(!1),o(-1)}).catch(r=>{console.log(r),l.error(r.response.data.message),n(!1)})}};return a.jsx(a.Fragment,{children:a.jsxs("div",{children:[a.jsx("div",{className:"fixed_header",children:a.jsxs("button",{className:"back-btn mb-2",onClick:()=>{window.history.back()},children:[a.jsx(E,{}),"Back"]})}),a.jsxs("div",{className:"main-content-profile",children:[a.jsx("div",{className:"px-3 pb-3 ",children:a.jsx(B,{location:s,setLocation:k,setAddress:f})}),a.jsx("div",{className:"px-3 pb-3",children:a.jsx("button",{onClick:S,className:"fill ",style:{marginBottom:"90px"},children:A?"Submitting...":"Submit"})})]})]})})};export{I as default};
