import{u as V,c as O,r as p,j as e,e as R,A as w,G as U,y as q}from"./index-DEIqmbY-.js";import{u as _,I as x,o as G,c as D,b as M,a as l}from"./index.esm-CAr2bw5T.js";import{F as T}from"./FileInput-B9h8R-UV.js";import{G as $}from"./GooglePlacesAutocomplete-82yjwKBa.js";import{u as z}from"./esm-4GqwfAtj.js";import"./file-CP6wb8cz.js";import"./index-C6PswM7T.js";const K=D().shape({fname:l().required("First name is required"),lname:l(),email:l().nullable().trim().test("is-valid-email","Invalid email",i=>!i||l().email().isValidSync(i)),address:D().shape({street_1:l().required("Street is required"),city:l().required("City is required"),state:l().required("State is required"),country:l().required("Country is required"),zip:l().required("Zip code is required")}),file:M().test("fileType","Invalid file type",i=>{if(!i||i.length===0)return!0;const o=i[0];return["image/jpeg","image/png","image/jpg"].includes(o.type)})}),X=()=>{var b,N,y,v,S,L,E;const i=V(),o=O("profile-details"),g=()=>{o.setLoading(!0),w.post("/user/getCustomerDetails").then(s=>{console.log(s),a("fname",s.data.customer.fname),a("lname",s.data.customer.lname),a("email",s.data.customer.email),a("address",s.data.address)}).catch(s=>{console.log(s)}).finally(()=>{o.setLoading(!1)})};p.useEffect(()=>{g()},[]);const[d,h]=p.useState(!1),{handleSubmit:A,control:n,setValue:a,formState:{errors:c},watch:F}=_({resolver:G(K)}),[j,f]=p.useState(null),m=F("file");p.useEffect(()=>{if(m&&m.length>0){const s=m[0],r=URL.createObjectURL(s);return f(r),()=>{URL.revokeObjectURL(r),f(null)}}else f(null)},[m]);const P=s=>{const r=new FormData;Object.entries(s).forEach(([t,u])=>{t==="file"?r.append(t,u[0]):typeof u=="object"?r.append(t,JSON.stringify(u)):r.append(t,String(u))}),console.log("âœ… Final FormData (to send via API):",s),h(!0),w.post("/user/updateCustomerDetails",r).then(t=>{console.log(t),h(!1),q.success(t.message),i(-1)}).catch(t=>{console.log(t),q.error(t.response.data.message),h(!1)})},C=s=>{console.log("Selected Address:",s),a("address.street_1",s.fullAddress,{shouldValidate:!0,shouldDirty:!0}),s.city&&a("address.city",s.city,{shouldValidate:!0,shouldDirty:!0}),s.state&&a("address.state",s.state,{shouldValidate:!0,shouldDirty:!0}),s.postalCode&&a("address.zip",s.postalCode,{shouldValidate:!0,shouldDirty:!0}),s.country&&a("address.country",s.country,{shouldValidate:!0,shouldDirty:!0})},{isLoaded:I}=z({googleMapsApiKey:U,libraries:["places"]});return I?e.jsxs(e.Fragment,{children:[e.jsx(R,{}),e.jsxs("div",{className:"container mb-8 main-content-service",children:[o.loading&&e.jsxs("div",{className:"full-page-loader",children:[e.jsx("div",{className:"loader-spinner"}),e.jsx("p",{children:"Loading Profile details..."})]}),e.jsx("div",{className:"row pt-4",children:e.jsx("div",{className:"col-12",children:e.jsx("h6",{className:"head4 text-center",children:"Edit Profile"})})}),e.jsxs("div",{className:"row px-3 pt-3",children:[e.jsxs("div",{className:"col-6 pt-3",children:[e.jsx("label",{className:"lbl2",children:"First Name"}),e.jsx(x,{control:n,name:"fname",label:"",type:"text",placeholder:"Enter First Name",inputMode:"text",error:(b=c.fname)==null?void 0:b.message,disabled:d})]}),e.jsxs("div",{className:"col-6 pt-3",children:[e.jsx("label",{className:"lbl2",children:"Last Name"}),e.jsx(x,{control:n,name:"lname",label:"",type:"text",placeholder:"Enter Last Name",inputMode:"text",error:(N=c.lname)==null?void 0:N.message,disabled:d})]}),e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("label",{className:"lbl2",children:"Email"}),e.jsx(x,{control:n,name:"email",label:"",type:"text",placeholder:"Enter Email",inputMode:"text",error:(y=c.email)==null?void 0:y.message,disabled:d})]}),e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("label",{className:"lbl2",children:"Address"}),e.jsx($,{control:n,name:"address.street_1",onSelect:C,label:"",error:(L=(S=(v=c.address)==null?void 0:v.street_1)==null?void 0:S.message)==null?void 0:L.toString()})]})]}),e.jsx("div",{className:"row px-3 pt-3",children:e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("label",{className:"lbl2",children:"Upload Profile Image"}),e.jsx(T,{name:"file",label:"",control:n,error:(E=c.file)==null?void 0:E.message}),e.jsx("div",{className:"col-12 pt-2",style:{textAlign:"center"},children:j&&e.jsx("img",{style:{height:"120px",width:"120px",borderRadius:8},src:j,alt:"Profile preview",className:"img-fluid"})})]})}),e.jsx("div",{className:"row px-3 pt-3",children:e.jsx("div",{className:"col-12",children:e.jsx("button",{onClick:A(P),disabled:d,className:"fill",children:d?"Loading...":"Update Profile"})})})]})]}):e.jsx("p",{children:"Loading..."})};export{X as default};
