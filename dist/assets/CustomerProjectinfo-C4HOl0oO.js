import{r as l,j as e,A as S,d as C,b as R,u as M,c as Y,e as E,M as z}from"./index-DEIqmbY-.js";import{d as w}from"./dayjs.min-CYIzaLsb.js";import{C as B}from"./check-C_WSaMOH.js";import{U as L}from"./user-ChMz2pK8.js";const F=({booking_id:i,service_id:o,onSubmitSuccess:h})=>{const[s,c]=l.useState(null),[m,y]=l.useState(""),[x,j]=l.useState(!1),[f,p]=l.useState(null),[g,u]=l.useState(!1),[n,v]=l.useState(null),[b,a]=l.useState(!0);l.useEffect(()=>{i&&(async()=>{a(!0);try{const t=await S.post("/user/getCustomerServiceReview",{booking_id:i});t!=null&&t.data&&v(t.data)}catch{console.log("No existing review found")}finally{a(!1)}})()},[i]);const _=async()=>{var r,t;if(!s){p("Please select a rating and provide your feedback.");return}j(!0),p(null);try{const d={booking_id:i,service_id:o,rating:s,review:m.trim()};await S.post("/user/addServiceReview",d)&&(u(!0),c(null),y(""),setTimeout(async()=>{try{const N=await S.post("/user/getCustomerServiceReview",{booking_id:i});N!=null&&N.data&&v(N.data)}catch{console.log("Error re-fetching review after submission")}u(!1),h&&h()},3e3))}catch(d){p(((t=(r=d==null?void 0:d.response)==null?void 0:r.data)==null?void 0:t.message)||"Failed to submit review. Please try again."),console.error("Error submitting review:",d)}finally{j(!1)}};if(g)return e.jsx("div",{className:"pt-4 px-2",children:e.jsx("div",{className:"px-4 pt-3",children:e.jsx("div",{className:"alert alert-success",role:"alert",children:e.jsx("p",{className:"mb-0",children:"Thank you for your feedback!"})})})});if(n&&!b){const r={1:"ðŸ˜¡",2:"ðŸ˜’",3:"ðŸ™‚",4:"â˜ºï¸",5:"ðŸ¥³"},t={1:"Very Bad",2:"Bad",3:"Good",4:"Very Good",5:"Excellent"};return e.jsx("div",{className:"  pb-5 mb-5",children:e.jsx("div",{className:"",children:e.jsxs("div",{style:{backgroundColor:"#fff",borderRadius:"12px",border:"1px solid #e0e0e0",padding:"20px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.08)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"16px"},children:[e.jsx("h5",{style:{margin:0,fontSize:"16px",fontWeight:"600",color:"#333"},children:"Your Review"}),e.jsx("span",{style:{fontSize:"12px",color:"#999"},children:new Date(n.created_on).toLocaleDateString()})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"12px",padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"8px",marginBottom:"16px"},children:[e.jsx("span",{style:{fontSize:"40px"},children:r[n.rating]}),e.jsxs("div",{children:[e.jsx("p",{style:{margin:"0 0 4px 0",fontSize:"14px",fontWeight:"600",color:"#333"},children:t[n.rating]}),e.jsx("div",{style:{display:"flex",gap:"4px"},children:[1,2,3,4,5].map(d=>e.jsx("span",{style:{fontSize:"16px",color:d<=n.rating?"#ffc107":"#ddd"},children:"â˜…"},d))})]})]}),e.jsx("div",{style:{marginTop:"16px"},children:e.jsx("p",{style:{margin:0,fontSize:"14px",color:"#555",lineHeight:"1.6",padding:"12px",backgroundColor:"#fafafa",borderRadius:"6px",borderLeft:"3px solid #2196F3"},children:n.review})}),e.jsx("div",{style:{marginTop:"16px",padding:"10px 12px",backgroundColor:"#e3f2fd",borderRadius:"6px",textAlign:"center"},children:e.jsx("p",{style:{margin:0,fontSize:"12px",color:"#1976d2",fontWeight:"500"},children:"âœ“ Thank you for your valuable feedback!"})})]})})})}return e.jsx(e.Fragment,{children:e.jsx("div",{className:"",children:e.jsxs("div",{className:"card_rev_ind",children:[e.jsx("h6",{className:"reves_head",children:"We appreciate your feedback."}),e.jsx("p",{className:"font-14 color-grey mb-2 pt-2",children:"We always looking for ways to improve your experience. Please take a moment to evaluate and tell us what you think."}),f&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:e.jsx("p",{className:"mb-0 font-12",children:f})}),e.jsxs("div",{className:"reviewratings pt-4 pb-3",children:[e.jsx("input",{type:"radio",id:"verybad",name:"rating",checked:s===1,onChange:()=>c(1),style:{display:"none"}}),e.jsxs("label",{className:"emj_lbl",htmlFor:"verybad",onClick:r=>{r.preventDefault(),c(1)},style:{cursor:"pointer"},children:[e.jsx("span",{children:"ðŸ˜¡"}),e.jsx("p",{children:"Very Bad"})]}),e.jsx("input",{type:"radio",id:"bad",name:"rating",checked:s===2,onChange:()=>c(2),style:{display:"none"}}),e.jsxs("label",{className:"emj_lbl",htmlFor:"bad",onClick:r=>{r.preventDefault(),c(2)},style:{cursor:"pointer"},children:[e.jsx("span",{children:"ðŸ˜’"}),e.jsx("p",{children:"Bad"})]}),e.jsx("input",{type:"radio",id:"good",name:"rating",checked:s===3,onChange:()=>c(3),style:{display:"none"}}),e.jsxs("label",{className:"emj_lbl",htmlFor:"good",onClick:r=>{r.preventDefault(),c(3)},style:{cursor:"pointer"},children:[e.jsx("span",{children:"ðŸ™‚"}),e.jsx("p",{children:"Good"})]}),e.jsx("input",{type:"radio",id:"verygood",name:"rating",checked:s===4,onChange:()=>c(4),style:{display:"none"}}),e.jsxs("label",{className:"emj_lbl",htmlFor:"verygood",onClick:r=>{r.preventDefault(),c(4)},style:{cursor:"pointer"},children:[e.jsx("span",{children:"â˜ºï¸"}),e.jsx("p",{children:"Very Good"})]}),e.jsx("input",{type:"radio",id:"excellent",name:"rating",checked:s===5,onChange:()=>c(5),style:{display:"none"}}),e.jsxs("label",{className:"emj_lbl",htmlFor:"excellent",onClick:r=>{r.preventDefault(),c(5)},style:{cursor:"pointer"},children:[e.jsx("span",{children:"ðŸ¥³"}),e.jsx("p",{children:"Excellent"})]})]}),e.jsx("div",{className:"pt-3",children:e.jsx("textarea",{className:"textar",value:m,onChange:r=>y(r.target.value),placeholder:"Share your feedback...",disabled:x})}),e.jsx("div",{className:"pt-4",children:e.jsx("button",{className:"fill",onClick:_,disabled:x,children:x?"Submitting...":"Submit"})})]})})})},W=()=>{var j,f,p,g,u,n,v,b;const{id:i}=C(),o=R(),h=M(),[s,c]=l.useState({}),m=Y("booking-details"),y=()=>{var a;(a=o==null?void 0:o.state)!=null&&a.fromNotifications?h("/notifications",{state:{scrollPosition:o.state.scrollPosition,itemIndex:o.state.itemIndex}}):h(-1)},x=()=>{m.setLoading(!0),S.post("/user/userBookingDetails",{booking_id:i}).then(a=>{console.log(a),c(a.data)}).catch(a=>{console.log(a)}).finally(()=>{m.setLoading(!1)})};return l.useEffect(()=>{x()},[i]),e.jsxs(e.Fragment,{children:[e.jsx(E,{customBack:y}),m.loading&&e.jsxs("div",{className:"full-page-loader",children:[e.jsx("div",{className:"loader-spinner"}),e.jsx("p",{children:"Loading request details..."})]}),e.jsxs("div",{className:" main-content-service2",children:[e.jsxs("div",{className:"pt-4 pb-0 ",children:[e.jsx("div",{className:"px-3",children:e.jsxs("div",{className:"cards5 ",children:[e.jsx("p",{className:"font-14 mb-2 ",children:"Project Details"}),e.jsxs("div",{className:"pt-2 pb-2",children:[e.jsx("h5",{className:"head5",children:e.jsx("b",{children:s==null?void 0:s.service_name})}),e.jsxs("p",{className:"mb-0 font-14 color-blue",children:["Booking ID: ",s==null?void 0:s.bkng_id]})]}),e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"d-flex  align-items-center  gap-1 pb-2 pt-1",children:[e.jsx(z,{size:14}),e.jsx("p",{className:"m-0 font-14 ",children:"Location"})]}),e.jsxs("p",{className:"mb-0 font-14",children:[(j=s==null?void 0:s.address)==null?void 0:j.street_1,","," ",(f=s==null?void 0:s.address)==null?void 0:f.city,",",(p=s==null?void 0:s.address)==null?void 0:p.state,","," ",(g=s==null?void 0:s.address)==null?void 0:g.zip]})]})]})}),e.jsx("div",{className:"px-3 pt-3",children:e.jsx("div",{className:"cards5",children:e.jsxs("p",{className:"font-14 mb-0",children:["The request will start -"," ",w(s==null?void 0:s.date).format("dddd, MMMM D YYYY")," @"," ",s==null?void 0:s.booking_time]})})})]}),e.jsx("div",{className:"container pb-10",children:e.jsxs("div",{className:"row px-1 pt-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"cards5",children:[e.jsx("b",{className:"mb-1 font-14 color-grey",children:"Job Description"}),e.jsx("p",{className:"mb-0 font-14",children:(s==null?void 0:s.job_description)||"No description provided"}),e.jsx("h5",{className:"font-14 pt-2",children:"Your request has been booked!"}),(s==null?void 0:s.booking_status)==="cancelled"?e.jsx("p",{className:"font-14 text-danger ",children:"Your request has been cancelled!"}):e.jsx("div",{className:"   ",children:(s==null?void 0:s.booking_status_timeline)&&(s==null?void 0:s.booking_status_timeline.map((a,_)=>e.jsxs("div",{className:"chk "+(a!=null&&a.timestamp?"active":""),children:[e.jsx("span",{children:e.jsx(B,{})}),e.jsxs("div",{children:[a.status,a.timestamp&&e.jsx("p",{className:"font-12 text-muted mb-0 mt-1",children:w(a.timestamp).format("MMM D, h:mm A")})]})]},_)))}),e.jsxs("p",{className:"font-12",children:["You booked this request on"," ",w(s==null?void 0:s.date).format("dddd, MMMM D YYYY")," for"," ",s==null?void 0:s.booking_time]})]})}),e.jsx("div",{className:"col-12 pt-3",children:e.jsx("h4",{className:"font-16",children:"Service Details"})}),e.jsx("div",{className:"col-12 pt-1",children:e.jsxs("div",{className:"cards5",children:[e.jsxs("div",{className:"d-flex gap-10 align-items-center",children:[e.jsx(L,{size:20}),s==null?void 0:s.service_name]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-6 pt-3",children:[e.jsx("p",{className:"mb-1 font-12 color-grey",children:"Date"}),e.jsx("p",{className:"mb-0 mb-0 font-14",children:w(s==null?void 0:s.date).format("dddd, MMMM D YYYY")})]}),e.jsxs("div",{className:"col-6 pt-3",children:[e.jsx("p",{className:"mb-1 font-12 color-grey",children:"Start time"}),e.jsx("p",{className:"mb-0 mb-0 font-14",children:s==null?void 0:s.booking_time})]}),e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("p",{className:"mb-1 font-12 color-grey",children:"Servicemen"}),e.jsx("p",{className:"mb-0 mb-0 font-14",children:s==null?void 0:s.servicemen_name}),e.jsx("p",{className:"mb-0 mb-0 font-14",children:s==null?void 0:s.servicemen_phone})]}),e.jsxs("div",{className:"col-12 pt-3",children:[e.jsx("p",{className:"mb-1 font-12 color-grey",children:"Address"}),e.jsxs("p",{className:"mb-0 mb-0 font-14",children:[(u=s==null?void 0:s.address)==null?void 0:u.street_1,","," ",(n=s==null?void 0:s.address)==null?void 0:n.city,","," ",(v=s==null?void 0:s.address)==null?void 0:v.state,","," ",(b=s==null?void 0:s.address)==null?void 0:b.zip]})]})]})]})}),e.jsx("div",{className:"col-12 pt-3 pb-3",children:e.jsxs("div",{className:"row px-1",children:[e.jsx("div",{className:"col-6",children:e.jsx("p",{className:"font-14",children:"Booking Cost"})}),e.jsx("div",{className:"col-6",children:e.jsxs("p",{className:"font-14 text-right",children:["â‚¹",s==null?void 0:s.booking_amount]})})]})}),(s==null?void 0:s.booking_status)==="completed"&&e.jsx("div",{className:"col-12 pt-2",children:e.jsx(F,{booking_id:s==null?void 0:s.booking_id,service_id:s==null?void 0:s.service_id,onSubmitSuccess:()=>{x()}})})]})})]})]})};export{W as default};
