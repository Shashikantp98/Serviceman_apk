import{r as y,R as w,P as _,a as se,u as oe,b as re,j as t,C as ne,M as ae,G as I,A as j,y as p}from"./index-DEIqmbY-.js";import{G as ie,a as W}from"./GoogleMapComponent-D7VrRrP3.js";import{c as ce,a as b,u as le,I as S,o as ue}from"./index.esm-CAr2bw5T.js";import{u as de}from"./esm-4GqwfAtj.js";import{G as pe}from"./GooglePlacesAutocomplete-82yjwKBa.js";import"./index-C6PswM7T.js";function z(){return z=Object.assign||function(i){for(var l=1;l<arguments.length;l++){var c=arguments[l];for(var r in c)Object.prototype.hasOwnProperty.call(c,r)&&(i[r]=c[r])}return i},z.apply(this,arguments)}function me(i,l){if(i==null)return{};var c=he(i,l),r,o;if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);for(o=0;o<n.length;o++)r=n[o],!(l.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(i,r)&&(c[r]=i[r])}return c}function he(i,l){if(i==null)return{};var c={},r=Object.keys(i),o,n;for(n=0;n<r.length;n++)o=r[n],!(l.indexOf(o)>=0)&&(c[o]=i[o]);return c}var N=y.forwardRef(function(i,l){var c=i.color,r=c===void 0?"currentColor":c,o=i.size,n=o===void 0?24:o,h=me(i,["color","size"]);return w.createElement("svg",z({ref:l,xmlns:"http://www.w3.org/2000/svg",width:n,height:n,viewBox:"0 0 24 24",fill:"none",stroke:r,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},h),w.createElement("circle",{cx:"12",cy:"12",r:"2"}),w.createElement("path",{d:"M16.24 7.76a6 6 0 0 1 0 8.49m-8.48-.01a6 6 0 0 1 0-8.49m11.31-2.82a10 10 0 0 1 0 14.14m-14.14 0a10 10 0 0 1 0-14.14"}))});N.propTypes={color:_.string,size:_.oneOfType([_.string,_.number])};N.displayName="Radio";const ve=()=>{var L,O,M,E,P,$,q,D,G,B,F,T,R,V;const{login:i}=se(),l=oe(),c=re(),[r,o]=y.useState(!1),n=(L=c.state)==null?void 0:L.token,h=(O=c.state)==null?void 0:O.phone_number,v=(M=c.state)==null?void 0:M.country_code,d=(E=c.state)==null?void 0:E.user_type,[J,A]=y.useState(!1),[a,k]=y.useState(null),[u,C]=y.useState({street_1:"",city:"",state:"",zip:"",country:""}),K=async()=>{if((await W.requestPermissions()).location==="granted"){const s=await W.getCurrentPosition();k({lat:s.coords.latitude,lng:s.coords.longitude}),A(!0)}else alert("Location permission not granted")},Z=()=>{A(!1)},U=async()=>{if(!(a!=null&&a.lat)||!(a!=null&&a.lng))return;const s=await(await fetch(`https://maps.googleapis.com/maps/api/geocode/json?latlng=${a==null?void 0:a.lat},${a==null?void 0:a.lng}&key=${I}`)).json();C({street_1:s.results[0].address_components[0].long_name,city:s.results[0].address_components[1].long_name,state:s.results[0].address_components[2].long_name,zip:s.results[0].address_components[3].long_name,country:s.results[0].address_components[4].long_name})};y.useEffect(()=>{a!=null&&a.lat&&(a!=null&&a.lng)&&U()},[a]);const Y=()=>{if(o(!0),d==="customer"&&j.post("/user/addCustomerAddress",{street_1:u.street_1+", "+u.city+", "+u.state+", "+u.country,city:u.city,state:u.state,zip:u.zip,country:u.country},{headers:{Authorization:`Bearer ${n}`}}).then(async e=>{console.log(e),p.success(e.message);const s=window.fcmToken||"";s&&await j.post("/user/updateFcmToken",{fcm_token:s,user_type:"customer"},{headers:{Authorization:`Bearer ${n}`}}).catch(m=>console.error("FCM token update failed:",m)),o(!1),i(n,d),l("/home",{state:{phone_number:h,country_code:v,user_type:d,token:n}})}).catch(e=>{console.log(e),p.error(e.response.data.message),o(!1)}),d==="servicemen"){const e=new FormData;e.append("home_address",JSON.stringify({street_1:u.street_1+", "+u.city+", "+u.state+", "+u.country,city:u.city,state:u.state,zip:u.zip,country:u.country})),j.post("/servicemen/editServicemen",e,{headers:{Authorization:`Bearer ${n}`}}).then(s=>{console.log(s),p.success(s.message),o(!1),l("/registration",{state:{phone_number:h,country_code:v,user_type:d,token:n}})}).catch(s=>{console.log(s),p.error(s.response.data.message),o(!1)})}},H=ce({street_1:b().required("Street Address One is required"),city:b().required("City is required"),state:b().required("State is required"),zip:b().required("Zip is required").min(4,"Zip must be at least 4 characters"),country:b().required("Country is required")}),{handleSubmit:Q,formState:{errors:g},control:f,setValue:x}=le({resolver:ue(H)}),X=e=>{if(o(!0),d==="customer"&&j.post("/user/addCustomerAddress",{street_1:e.street_1+", "+e.city+", "+e.state+", "+e.country,city:e.city,state:e.state,zip:e.zip,country:e.country},{headers:{Authorization:`Bearer ${n}`}}).then(s=>{console.log(s),p.success(s.message),o(!1),i(n,d),l("/home",{state:{phone_number:h,country_code:v,user_type:d,token:n}})}).catch(s=>{console.log(s),p.error(s.response.data.message),o(!1)}),d==="servicemen"){const s=new FormData;s.append("home_address",JSON.stringify({street_1:e.street_1+", "+e.city+", "+e.state+", "+e.country,city:e.city,state:e.state,zip:e.zip,country:e.country})),j.post("/servicemen/editServicemen",s,{headers:{Authorization:`Bearer ${n}`}}).then(m=>{console.log(m),p.success(m.message),o(!1),l("/registration",{state:{phone_number:h,country_code:v,user_type:d,token:n}})}).catch(m=>{console.log(m),p.error(m.response.data.message),o(!1)})}},ee=e=>{console.log("Selected Address:",e),x("street_1",e.fullAddress,{shouldValidate:!0,shouldDirty:!0}),e.city&&x("city",e.city,{shouldValidate:!0,shouldDirty:!0}),e.state&&x("state",e.state,{shouldValidate:!0,shouldDirty:!0}),e.postalCode&&x("zip",e.postalCode,{shouldValidate:!0,shouldDirty:!0}),e.country&&x("country",e.country,{shouldValidate:!0,shouldDirty:!0})},{isLoaded:te}=de({googleMapsApiKey:I,libraries:["places"]});return te?t.jsxs(t.Fragment,{children:[t.jsx("div",{style:{position:"absolute"},children:t.jsxs("button",{className:"back-btn mb-3 mt-5 px-3 py-3",style:{color:"#000"},onClick:()=>{l(-1)},children:[t.jsx(ne,{})," Back"]})}),t.jsxs("div",{className:"px-5 pt-5 pb-3",children:[t.jsx("div",{className:"pin",children:t.jsx(ae,{})}),t.jsx("h3",{className:"head2 pt-3",children:"What’s your location?"}),t.jsx("p",{className:"text-center color-grey font-12",children:"Find an artist or studio near your location"})]}),J?t.jsxs("div",{className:"",children:[t.jsx("div",{className:"px-3 pb-3 ",children:t.jsx(ie,{location:a,setLocation:k,setAddress:C})}),t.jsx("button",{onClick:Y,style:{position:"fixed",bottom:"85px",width:"90%",left:"5%"},className:"fill",children:r?"Submitting...":"Submit"}),t.jsx("button",{style:{position:"fixed",bottom:"25px",width:"90%",left:"5%"},className:"outline",onClick:Z,children:"Set Manually"})]}):t.jsxs("div",{children:[t.jsx("div",{className:"px-4",children:t.jsxs("button",{className:"outline d-flex align-items-center",onClick:K,children:[t.jsx(N,{}),"  Use Current Location"]})}),t.jsx("div",{className:"px-4",children:t.jsx("p",{className:"font-12 mb-0 mt-3",children:"Set manually"})}),t.jsxs("div",{className:"row px-4",children:[t.jsx("div",{className:"col-12 pt-3",children:t.jsx(pe,{control:f,name:"street_1",onSelect:ee,label:"",error:($=(P=g.street_1)==null?void 0:P.message)==null?void 0:$.toString()})}),t.jsx("div",{className:"col-6 pt-3",children:t.jsx(S,{control:f,name:"city",label:"",type:"text",placeholder:"Enter city",inputMode:"text",error:(D=(q=g.city)==null?void 0:q.message)==null?void 0:D.toString(),disabled:r})}),t.jsx("div",{className:"col-6 pt-3",children:t.jsx(S,{control:f,name:"state",label:"",type:"text",placeholder:"Enter state",inputMode:"text",error:(B=(G=g.state)==null?void 0:G.message)==null?void 0:B.toString(),disabled:r})}),t.jsx("div",{className:"col-6 pt-3",children:t.jsx(S,{control:f,name:"country",label:"",type:"text",placeholder:"Enter country",inputMode:"text",error:(T=(F=g.country)==null?void 0:F.message)==null?void 0:T.toString(),disabled:r})}),t.jsx("div",{className:"col-6 pt-3",children:t.jsx(S,{control:f,name:"zip",label:"",type:"text",placeholder:"Enter zip",inputMode:"numeric",error:(V=(R=g.zip)==null?void 0:R.message)==null?void 0:V.toString(),disabled:r})})]}),t.jsx("div",{className:"px-4 mt-5",children:t.jsxs("button",{className:"fill",onClick:Q(X),disabled:r,children:[" ",r?"Saving...":"Save Address"]})})]})]}):t.jsx("p",{children:"Loading..."})};export{ve as default};
